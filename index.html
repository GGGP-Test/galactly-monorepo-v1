<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Galactly — Transfusion AI</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
<style>
:root{--ink:#fff;--ink-d:#cfd3df;--stroke:rgba(255,255,255,.10);--accent:#86f7d6;--accent2:#57a4ff;--accent3:#ffc857;--bg:#000;--panel:#0b0c13;--panel2:#090a10;--mont:Montserrat,Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif;--inter:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;color:var(--ink);background:#000;font-family:var(--inter);line-height:1.55;overflow-x:hidden}

/* ====== NAV (centered) ====== */
header{position:sticky;top:0;z-index:40;backdrop-filter:blur(10px) saturate(1.05);background:rgba(0,0,0,.55);border-bottom:1px solid var(--stroke)}
.nav{max-width:1240px;margin:auto;padding:10px 18px;display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:12px}
.brand{display:flex;align-items:center;gap:10px;color:#fff;text-decoration:none}
.brand svg{width:26px;height:26px}
.brand b{font:800 16px var(--mont)}
.menu{justify-self:center;display:flex;gap:16px}
.menu a{color:#fff;text-decoration:none;padding:8px 10px;border-radius:12px;border:1px solid transparent}
.menu a:hover{background:rgba(255,255,255,.06);border-color:var(--stroke)}
.nav-cta{justify-self:end}
.nav-cta .btn{padding:9px 12px;border-radius:12px}

/* ====== HERO ====== */
.hero{position:relative;min-height:720px;border-bottom:1px solid var(--stroke);background:
  radial-gradient(1200px 700px at 25% -10%,rgba(255,255,255,.06),rgba(0,0,0,0) 60%),
  radial-gradient(900px 500px at 80% 120%,rgba(255,255,255,.05),rgba(0,0,0,0) 60%),
  linear-gradient(180deg,#0b0c13,#06070c)}
.wrap{max-width:1240px;margin:auto;display:grid;grid-template-columns:1fr min(780px,52%);gap:44px;align-items:center;padding:44px 28px}
@media (max-width:1100px){.wrap{grid-template-columns:1fr}}
.copy h1{font:800 clamp(28px,4.5vw,56px) var(--mont);line-height:1.08;margin:0 0 12px}
.copy .accent{background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;background-clip:text;color:transparent}
.copy p{opacity:.94;margin:16px 0 0}
.copy .sub{opacity:.86;font-size:14px;margin-top:12px}
.copy .cta{display:flex;gap:14px;margin-top:34px;flex-wrap:wrap}
.btn{border:1px solid var(--stroke);background:#111214;color:#fff;padding:12px 16px;border-radius:12px;text-decoration:none;font-weight:800}
.btn.white{background:#fff;color:#0b0c12}
.btn.small{padding:8px 12px;font-weight:800}

.flow{position:relative;background:linear-gradient(180deg,#0b0b10,#07080d);border:1px solid var(--stroke);border-radius:18px;padding:14px;box-shadow:0 12px 40px rgba(0,0,0,.38)}
.flow .glass{position:relative;border-radius:16px;background:
  radial-gradient(120% 130% at 65% 35%,rgba(255,255,255,.06),rgba(255,255,255,.02)),
  radial-gradient(90% 120% at 20% 80%,rgba(255,255,255,.05),rgba(255,255,255,.01));
  overflow:hidden;min-height:400px}
.flow .glass::before{content:"";display:block;padding-top:56.25%}
#flowCanvas{position:absolute;inset:0;width:100%;height:100%;display:block;border-radius:16px}
.meta{display:flex;flex-wrap:wrap;gap:10px;margin-top:14px;align-items:center;min-height:38px}
.badge{background:#0b0d14;border:1px solid var(--stroke);border-radius:12px;padding:7px 11px;font:700 12px var(--mont);display:flex;gap:6px;align-items:center}
.badge small{opacity:.75;font-weight:600}
.badge .num{font-variant-numeric:tabular-nums;font-family:ui-monospace,Menlo,Consolas,monospace;min-width:3ch;text-align:right}
.ticker{margin-top:14px;max-height:108px;overflow:auto;border-top:1px solid var(--stroke);padding-top:10px;scrollbar-width:none;-ms-overflow-style:none}
.ticker::-webkit-scrollbar{width:0;height:0}
.ti{font-size:12px;opacity:.95;padding:5px 0;border-bottom:1px dashed rgba(255,255,255,.06)}
.ti:last-child{border-bottom:none}

/* ====== ENGINES (parallax section) ====== */
.section{position:relative;max-width:1240px;margin:0 auto;padding:80px 28px}
.parallax-bg{position:absolute;inset:-10% -5% auto -5%;height:320px;pointer-events:none;z-index:0}
.parallax-layer{position:absolute;inset:0;background:
  radial-gradient(600px 300px at 10% 40%,rgba(87,164,255,.12),transparent 60%),
  radial-gradient(500px 280px at 80% 60%,rgba(134,247,214,.10),transparent 65%)}

.h2{position:relative;font:800 24px var(--mont);margin:0 0 18px;z-index:1}
.engines{position:relative;z-index:1;display:grid;gap:16px}
@media (min-width:900px){.engines{grid-template-columns:1fr 1fr}}
.engine{position:relative;background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid var(--stroke);border-radius:16px;padding:16px;overflow:hidden}
.engine h3{margin:0;font:800 18px var(--mont)}
.badge.pill{font:700 11px var(--mont);opacity:.8;padding:6px 10px;border:1px solid var(--stroke);border-radius:999px}
.chips{display:flex;gap:6px;flex-wrap:wrap;margin:8px 0}
.chip{padding:6px 10px;border:1px solid var(--stroke);border-radius:999px;font:700 11px var(--mont);opacity:.92;cursor:pointer}
.chip.active{background:#fff;color:#0b0c12}
.kpiRow{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:10px 0}
.kpi{background:linear-gradient(180deg,#0f1118,#0c0f14);border:1px solid var(--stroke);border-radius:12px;padding:10px;transition:opacity .2s, box-shadow .2s}
.kpi small{opacity:.75}
.kpi b{display:block;margin-top:4px;font:800 22px var(--mont)}
.kpi.active{box-shadow:0 0 0 1px rgba(255,255,255,.28) inset}
.kpi.dim{opacity:.55}
.feed{margin-top:10px;max-height:140px;overflow:auto;border-top:1px solid var(--stroke);padding-top:8px;scrollbar-width:none;-ms-overflow-style:none}
.feed::-webkit-scrollbar{width:0;height:0}
.feed .row{font-size:12px;opacity:.95;padding:6px 0;border-bottom:1px dashed rgba(255,255,255,.06)}
.feed .row:last-child{border-bottom:none}
.feed .row.dim{opacity:.35}

/* engine accent shells */
.engine#maker{border-color:rgba(87,164,255,.35);box-shadow:0 0 0 1px rgba(87,164,255,.18) inset,0 8px 40px rgba(87,164,255,.06)}
.engine#maker h3{background:linear-gradient(90deg,#86f7d6,#57a4ff);-webkit-background-clip:text;background-clip:text;color:transparent}
.engine#saver{border-color:rgba(255,200,87,.35);box-shadow:0 0 0 1px rgba(255,200,87,.18) inset,0 8px 40px rgba(255,200,87,.06)}
.engine#saver h3{background:linear-gradient(90deg,#ffc857,#9fffbf);-webkit-background-clip:text;background-clip:text;color:transparent}
</style>
</head>
<body>
<header>
  <div class="nav">
    <a class="brand" href="#">
      <svg viewBox="0 0 64 64" aria-hidden="true">
        <defs><linearGradient id="g" x1="0" x2="1"><stop stop-color="#86f7d6"/><stop offset="1" stop-color="#57a4ff"/></linearGradient></defs>
        <circle cx="32" cy="32" r="30" fill="black" stroke="white" stroke-opacity=".15" stroke-width="2"/>
        <path d="M12 36c8 8 18 12 28 12 4 0 8-1 12-2" stroke="url(#g)" stroke-width="4" fill="none"/>
        <circle cx="20" cy="20" r="6" fill="url(#g)"/>
      </svg>
      <b>Galactly</b>
    </a>
    <nav class="menu">
      <a href="./free-panel.html">Live Leads</a>
      <a href="#engines">AI Engines</a>
      <a href="#pricing">Pricing</a>
      <a href="#docs">Docs</a>
    </nav>
    <div class="nav-cta"><a class="btn white small" href="./free-panel.html">Open Live Feed</a></div>
  </div>
</header>

<!-- ===== HERO ===== -->
<section class="hero" id="hero">
  <div class="wrap">
    <div class="copy">
      <h1><span class="accent">Transfusion AI</span> — one-click growth for packaging.</h1>
      <p>Finds live buyers online → thinks through the next step → sends simple, easy-to-follow actions that close.</p>
      <p class="sub">Built for packaging owners and sales teams. B2B / Corporate leads live. Outputs: Quote • Email • SMS • Call • LinkedIn DM • ERP updates. No coding. Just clicks.</p>
      <div class="cta">
        <a class="btn white" href="./free-panel.html">Open the Live Feed</a>
        <a class="btn" href="#" aria-disabled="true">▶ Watch demo</a>
      </div>
      <div class="meta">
        <div class="badge"><small>Humans online</small><span id="b-humans" class="num">00</span></div>
        <div class="badge"><small>Next refresh in</small><span id="b-next" class="num">15</span><small>s</small></div>
      </div>
      <div class="ticker" id="ticker"></div>
    </div>
    <div class="flow">
      <div class="glass"><canvas id="flowCanvas"></canvas></div>
      <div class="meta">
        <div class="badge"><small>Leads / 30 sec</small><span id="b-leads" class="num">0</span></div>
        <div class="badge"><small>First connection</small><span id="b-first" class="num">—</span></div>
        <div class="badge"><small>Ready now</small><span id="b-ready" class="num">—</span></div>
        <div class="badge"><small>Quoted</small><span id="b-quote" class="num">—</span></div>
        <div class="badge"><small>AI closed</small><span id="b-ai" class="num">—</span></div>
        <div class="badge"><small>Rep closed</small><span id="b-human" class="num">—</span></div>
        <div class="badge"><small>Saved / mo</small><span id="b-saved" class="num">—</span></div>
      </div>
    </div>
  </div>
</section>

<!-- ===== AI ENGINES (parallax) ===== -->
<section class="section" id="engines">
  <div class="parallax-bg" aria-hidden="true">
    <div class="parallax-layer" data-parallax="0.25"></div>
  </div>
  <div class="h2">Two AI engines</div>
  <div class="engines">
    <!-- AI Maker -->
    <div class="engine" id="maker">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
        <h3>AI Maker</h3>
        <span class="badge pill" id="mk_window">30s left</span>
      </div>
      <div class="chips" id="mk_chips"><span class='chip' data-kpi="find">Find</span><span class='chip' data-kpi="hot">Hot filter</span><span class='chip' data-kpi="first">First touch</span><span class='chip' data-kpi="route">Decision</span><span class='chip' data-kpi="quote">Quote</span><span class='chip' data-kpi="close">Close</span></div>
      <div class="kpiRow">
        <div class="kpi" data-k="find"><small>Leads / 30 sec</small><b id="mk_leads">0</b></div>
        <div class="kpi" data-k="hot"><small>Hot leads</small><b id="mk_hot">0</b></div>
        <div class="kpi" data-k="first"><small>First connection</small><b id="mk_first">—</b></div>
      </div>
      <div class="kpiRow">
        <div class="kpi" data-k="route"><small>Sent to human closer (of hot)</small><b id="mk_passed">0</b></div>
        <div class="kpi" data-k="route"><small>Sent to AI closer (of hot)</small><b id="mk_ai">0</b></div>
        <div class="kpi" data-k="route"><small>AI hand-off</small><b id="mk_handoff">—</b></div>
      </div>
      <div class="kpiRow">
        <div class="kpi" data-k="close"><small>Rep closes (of hot)</small><b id="mk_rep_closed">0</b></div>
        <div class="kpi" data-k="close"><small>AI closes (of hot)</small><b id="mk_ai_closed">0</b></div>
        <div class="kpi" data-k="quote"><small>Quote time</small><b id="mk_quote_sec">—</b></div>
      </div>
      <div class="feed" id="mk_feed"></div>
    </div>

    <!-- AI Saver -->
    <div class="engine" id="saver">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
        <h3>AI Saver</h3>
        <span class="badge pill" id="sv_window">30s left</span>
      </div>
      <div class="chips" id="sv_chips"><span class='chip' data-kpi="auto">Automation</span><span class='chip' data-kpi="support">Support</span><span class='chip' data-kpi="retain">Retention</span><span class='chip' data-kpi="savings">Savings</span></div>
      <div class="kpiRow">
        <div class="kpi" data-k="savings"><small>Saved / month</small><b id="sv_saved">$0</b></div>
        <div class="kpi" data-k="support"><small>Replies handled</small><b id="sv_auto">—</b></div>
        <div class="kpi" data-k="auto"><small>Tasks automated</small><b id="sv_tasks">—</b></div>
      </div>
      <div class="kpiRow">
        <div class="kpi" data-k="auto"><small>Internal tasks handled</small><b id="sv_internal">—</b></div>
        <div class="kpi" data-k="retain"><small>Quotes self generated</small><b id="sv_quotes">—</b></div>
        <div class="kpi" data-k="retain"><small>Quotes accuracy</small><b id="sv_qacc">—</b></div>
      </div>
      <div class="kpiRow">
        <div class="kpi" data-k="support"><small>CSAT improved</small><b id="sv_csat">—</b></div>
        <div class="kpi" data-k="savings"><small>Hours saved</small><b id="sv_hours">—</b></div>
        <div class="kpi" data-k="retain"><small>Churn saved</small><b id="sv_churn">—</b></div>
      </div>
      <div class="feed" id="sv_feed"></div>
    </div>
  </div>
</section>

<script>
// ===== Canvas lead-flow visual (US–Canada border, no layout shift) =====
const cvs=document.getElementById('flowCanvas');const DPR=Math.min(2.2,window.devicePixelRatio||1);
let ctx=null,started=false;const K={humans:document.getElementById('b-humans'),next:document.getElementById('b-next'),leads:document.getElementById('b-leads'),first:document.getElementById('b-first'),ready:document.getElementById('b-ready'),quote:document.getElementById('b-quote'),ai:document.getElementById('b-ai'),human:document.getElementById('b-human'),saved:document.getElementById('b-saved')};const ticker=document.getElementById('ticker');
let cx=0,cy=0,R=0,coreX=0,coreY=0,coreR=22;let chips=[];
const CHANNELS=[{name:'Email',color:'rgba(134,247,214,0.65)'},{name:'SMS',color:'rgba(160,255,160,0.65)'},{name:'Call',color:'rgba(159,208,255,0.65)'},{name:'LinkedIn',color:'rgba(120,200,255,0.65)'},{name:'Quote',color:'rgba(255,210,140,0.70)'},{name:'ERP',color:'rgba(200,170,255,0.70)'}];
const CITIES=[{city:'New York',lat:40.7128,lon:-74.006},{city:'Toronto',lat:43.6532,lon:-79.3832},{city:'Chicago',lat:41.8781,lon:-87.6298},{city:'Dallas',lat:32.7767,lon:-96.797},{city:'Miami',lat:25.7617,lon:-80.1918},{city:'Seattle',lat:47.6062,lon:-122.3321},{city:'San Francisco',lat:37.7749,lon:-122.4194},{city:'Los Angeles',lat:34.0522,lon:-118.2437},{city:'Mexico City',lat:19.4326,lon:-99.1332},{city:'Bogotá',lat:4.711,lon:-74.0721},{city:'São Paulo',lat:-23.5505,lon:-46.6333},{city:'Buenos Aires',lat:-34.6037,lon:-58.3816}];
const FIRST="Ava,Noah,Sophia,Liam,Isabella,Elijah,Mia,Lucas,Amelia,Mason,Harper,Logan,Evelyn,James,Abigail,Oliver,Emily".split(',');
const LAST="Smith,Johnson,Williams,Brown,Jones,Miller,Davis,Garcia,Wilson,Moore,Taylor,Anderson".split(',');
const pick=a=>a[(Math.random()*a.length)|0];const center={lat:25*Math.PI/180,lon:-90*Math.PI/180};
function proj(lat,lon){const dLon=lon-center.lon;const sinC=Math.sin(center.lat),cosC=Math.cos(center.lat);const sinLat=Math.sin(lat),cosLat=Math.cos(lat);const sinDL=Math.sin(dLon),cosDL=Math.cos(dLon);const k=sinC*sinLat+cosC*cosLat*cosDL;if(k<=0)return null;return{x:cx+R*(cosLat*sinDL),y:cy-R*(cosC*sinLat-sinC*cosLat*cosDL)}}
const LAND_NA=[[71,-156],[48,-124],[34,-118],[25,-111],[20,-105],[18,-103],[16,-99],[20,-90],[27,-81],[31,-80],[36,-76],[42,-72],[49,-64],[54,-60],[60,-75],[69,-95],[71,-156]];
const LAND_SA=[[10,-79],[8,-74],[5,-60],[0,-58],[-8,-54],[-18,-44],[-24,-42],[-30,-52],[-40,-61],[-48,-70],[-55,-66],[-33,-71],[-20,-70],[-12,-77],[-8,-79],[10,-79]];
const packets=[];const targets={leads:0,first:'8 sec',ready:'48%',quote:'62%',ai:'24%',human:'29%',saved:'$14,200'};const state={leads:0};
function updateBadges(){state.leads=Math.round(state.leads*0.95+targets.leads*0.05);K.leads.textContent=state.leads;K.first.textContent=targets.first;K.ready.textContent=targets.ready;K.quote.textContent=targets.quote;K.ai.textContent=targets.ai;K.human.textContent=targets.human;K.saved.textContent=targets.saved}
function pushTick(html){const d=document.createElement('div');d.className='ti';d.innerHTML=html;ticker.insertBefore(d,ticker.firstChild);while(ticker.children.length>6)ticker.lastElementChild.remove()}
function cubic(p0,p1,p2,p3,t){const it=1-t;return{x:it*it*it*p0.x+3*it*it*t*p1.x+3*it*t*t*p2.x+t*t*t*p3.x,y:it*it*it*p0.y+3*it*it*t*p1.y+3*it*t*t*p2.y+t*t*t*p3.y}}
function lerp(a,b,t){return a+(b-a)*t}
function resize(){const r=cvs.getBoundingClientRect();if(!r.width||!r.height){setTimeout(resize,60);return}cvs.width=Math.floor(r.width*DPR);cvs.height=Math.floor(r.height*DPR);cvs.style.width=r.width+'px';cvs.style.height=r.height+'px';ctx=cvs.getContext('2d');ctx.setTransform(DPR,0,0,DPR,0,0);cx=r.width*0.28;cy=r.height*0.56;R=Math.min(r.width*0.30,r.height*0.46);coreX=r.width*0.56;coreY=r.height*0.56;coreR=Math.max(18,Math.min(24,r.width*0.03));const baseX=r.width*0.83,baseY=coreY,rad=Math.min(110,r.height*0.20),a0=-Math.PI/3,a1=Math.PI/3;chips=CHANNELS.map((c,i)=>{const a=CHANNELS.length>1?a0+(a1-a0)*(i/(CHANNELS.length-1)):0;return{x:baseX+rad*Math.cos(a),y:baseY+rad*Math.sin(a),r:12,label:c.name,color:c.color}})}
window.addEventListener('resize',resize);
function drawHemisphere(){const g=ctx.createRadialGradient(cx,cy,R*0.2,cx,cy,R*1.1);g.addColorStop(0,'rgba(255,255,255,.05)');g.addColorStop(1,'rgba(0,0,0,0)');ctx.fillStyle=g;ctx.beginPath();ctx.arc(cx,cy,R,0,Math.PI*2);ctx.fill();ctx.strokeStyle='rgba(255,255,255,0.18)';ctx.lineWidth=1.2;ctx.beginPath();ctx.arc(cx,cy,R,0,Math.PI*2);ctx.stroke();ctx.beginPath();LAND_NA.concat(LAND_SA).forEach(([la,lo],i)=>{const P=proj(la*Math.PI/180,lo*Math.PI/180);if(!P)return;i?ctx.lineTo(P.x,P.y):ctx.moveTo(P.x,P.y)});ctx.closePath();ctx.fillStyle='rgba(134,247,214,0.09)';ctx.fill();ctx.strokeStyle='rgba(255,255,255,0.14)';ctx.stroke(); // 49th parallel (US–Canada)
  const pts=[];for(let lon=-130;lon<=-60;lon+=1.5){const P=proj(49*Math.PI/180,lon*Math.PI/180);if(P)pts.push(P);}if(pts.length){ctx.save();ctx.setLineDash([6,4]);ctx.lineWidth=1.4;ctx.strokeStyle='rgba(103,224,255,0.95)';ctx.beginPath();ctx.moveTo(pts[0].x,pts[0].y);for(let i=1;i<pts.length;i++)ctx.lineTo(pts[i].x,pts[i].y);ctx.stroke();ctx.restore();}}
function drawCore(t){const g=ctx.createRadialGradient(coreX,coreY,0,coreX,coreY,coreR*2.6);g.addColorStop(0,'rgba(255,255,255,.04)');g.addColorStop(1,'rgba(255,255,255,0)');ctx.fillStyle=g;ctx.beginPath();ctx.arc(coreX,coreY,coreR*2.6,0,Math.PI*2);ctx.fill();ctx.save();ctx.translate(coreX,coreY);for(let i=0;i<3;i++){const r=coreR+i*18;ctx.beginPath();ctx.arc(0,0,r,0,Math.PI*2);ctx.strokeStyle=`rgba(255,255,255,${0.14-i*0.02})`;ctx.lineWidth=1.2;ctx.stroke();const a0=t*0.4+i*0.6,a1=a0+Math.PI*0.42;ctx.beginPath();ctx.arc(0,0,r,a0,a1);const lg=ctx.createLinearGradient(Math.cos(a0)*r,Math.sin(a0)*r,Math.cos(a1)*r,Math.sin(a1)*r);lg.addColorStop(0,'rgba(255,255,255,.70)');lg.addColorStop(1,'rgba(255,255,255,.18)');ctx.strokeStyle=lg;ctx.lineWidth=3;ctx.stroke()}const pul=1+0.2*Math.sin(t*1.1),pr=coreR*0.9*pul,cg=ctx.createRadialGradient(0,0,0,0,0,pr*2.0);cg.addColorStop(0,'rgba(255,255,255,.90)');cg.addColorStop(1,'rgba(255,255,255,0)');ctx.globalCompositeOperation='lighter';ctx.beginPath();ctx.arc(0,0,pr*2.0,0,Math.PI*2);ctx.fillStyle=cg;ctx.fill();ctx.restore();ctx.globalCompositeOperation='source-over'}
function drawChannels(){CHANNELS.forEach((ch,i)=>{const chip=chips[i];if(!chip)return;ctx.save();ctx.strokeStyle=ch.color;ctx.globalAlpha=0.5;ctx.lineWidth=6;ctx.beginPath();ctx.moveTo(coreX,coreY);ctx.quadraticCurveTo((coreX+chip.x)/2,(coreY+chip.y*1.1)/2,chip.x,chip.y);ctx.stroke();ctx.globalAlpha=1;ctx.lineWidth=2;ctx.strokeStyle='rgba(255,255,255,0.18)';ctx.beginPath();ctx.moveTo(coreX,coreY);ctx.quadraticCurveTo((coreX+chip.x)/2,(coreY+chip.y*1.1)/2,chip.x,chip.y);ctx.stroke();const g=ctx.createRadialGradient(chip.x,chip.y,0,chip.x,chip.y,chip.r*2.2);g.addColorStop(0,ch.color);g.addColorStop(1,'rgba(255,255,255,0)');ctx.beginPath();ctx.arc(chip.x,chip.y,chip.r*2.0,0,Math.PI*2);ctx.fillStyle=g;ctx.fill();ctx.beginPath();ctx.arc(chip.x,chip.y,chip.r,0,Math.PI*2);ctx.strokeStyle='rgba(255,255,255,.24)';ctx.lineWidth=1.2;ctx.stroke();ctx.font="700 11px Montserrat, Inter, system-ui";ctx.fillStyle='rgba(255,255,255,.92)';ctx.textAlign='center';ctx.fillText(chip.label,chip.x,chip.y-chip.r-8);ctx.restore()})}
function drawPaths(t){ctx.save();ctx.globalCompositeOperation='lighter';packets.forEach(p=>{ctx.strokeStyle='rgba(255,255,255,0.12)';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(p.p0.x,p.p0.y);ctx.bezierCurveTo(p.p1.x,p.p1.y,p.p2.x,p.p2.y,p.p3.x,p.p3.y);ctx.stroke();const u=p.t,q=u*u*(3-2*u),A=cubic(p.p0,p.p1,p.p2,p.p3,q);ctx.beginPath();ctx.arc(A.x,A.y,2.2,0,Math.PI*2);ctx.fillStyle='rgba(255,255,255,0.96)';ctx.fill();if(p.phase==='core'){const chip=chips[p.idx];const u2=p.t2,q2=u2*u2*(3-2*u2);const bx=lerp(coreX,(coreX+chip.x)/2,q2),by=lerp(coreY,(coreY+chip.y*1.1)/2,q2);const px=lerp(bx,chip.x,q2),py=lerp(by,chip.y,q2);ctx.beginPath();ctx.arc(px,py,2.2,0,Math.PI*2);ctx.fillStyle=CHANNELS[p.idx].color;ctx.fill()}});ctx.restore()}
function spawn(){const c=CITIES[(Math.random()*CITIES.length)|0];const P=proj(c.lat*Math.PI/180,c.lon*Math.PI/180);if(!P)return;const name=pick(FIRST)+" "+pick(LAST);const start={x:P.x,y:P.y};const mpx=(start.x+coreX)/2,mpy=(start.y+coreY)/2;const p0=start,p1={x:mpx-40,y:mpy-30},p2={x:mpx+40,y:mpy+30},p3={x:coreX,y:coreY};const idx=(Math.random()*CHANNELS.length)|0;packets.push({p0,p1,p2,p3,idx,t:0,t2:0,phase:'toCore'});targets.leads=Math.min(500,targets.leads+(5+Math.random()*12|0));targets.first=((3+Math.random()*15)|0)+' sec';targets.ready=(35+Math.random()*30|0)+'%';targets.quote=(40+Math.random()*30|0)+'%';targets.ai=(12+Math.random()*18|0)+'%';targets.human=(18+Math.random()*28|0)+'%';targets.saved='$'+(12000+(Math.random()*18000|0)).toLocaleString();pushTick(`<strong>${name}</strong> · ${c.city} → <em>${CHANNELS[idx].name}</em>`)}
function update(dt){for(let i=packets.length-1;i>=0;i--){const p=packets[i];if(p.phase==='toCore'){p.t=Math.min(1,p.t+dt*0.08);if(p.t>=1){p.phase='core';p.t2=0}}else{p.t2=Math.min(1,p.t2+dt*0.06);if(p.t2>=1){packets.splice(i,1)}}}}
function draw(ts){const t=ts/1000;ctx.clearRect(0,0,cvs.width/DPR,cvs.height/DPR);drawHemisphere();drawPaths(t);drawCore(t);drawChannels()}
let last=0,acc=0;function loop(ts){requestAnimationFrame(loop);if(!last)last=ts;const dt=Math.min(0.05,(ts-last)/1000);last=ts;update(dt);draw(ts);updateBadges();acc+=dt;if(acc>(1.2+Math.random()*1.2)){acc=0;if(packets.length<12)spawn()}}
function init(){if(started)return;const r=cvs.getBoundingClientRect();if(!r.width||!r.height){setTimeout(init,60);return}started=true;resize();requestAnimationFrame(loop)}
requestAnimationFrame(init);

// ===== Live badges + ticker from backend =====
const uid=localStorage.getItem('uid')||('u-'+Math.random().toString(36).slice(2));localStorage.setItem('uid',uid);
function fmtAge(sec){ if(sec<60) return Math.floor(sec)+'s'; const m=sec/60; if(m<60) return Math.floor(m)+'m'; const h=m/60; if(h<24) return h.toFixed(1)+'h'; const d=h/24; return d.toFixed(1)+'d'; }
let tRem=15; async function ping(){ try{ const base=(window.API_BASE||'https://galactly-monorepo-v1.onrender.com'); const r=await fetch(base+'/api/v1/leads?fitMin=60&region=US',{headers:{'x-galactly-user':uid}}); const d=await r.json(); K.humans.textContent=String(d.humansOnline||0).padStart(2,'0'); if(Array.isArray(d.leads)){ ticker.innerHTML=d.leads.slice(0,6).map(L=>`<div class="ti">• <b>${L.kw}</b> — ${L.cat} <span style="opacity:.7">(${fmtAge(L.age)} ago)</span></div>`).join(''); } tRem=d.nextRefreshSec||15; }catch(e){ /* silent */ } }
setInterval(()=>{tRem=Math.max(0,tRem-1);K.next.textContent=String(tRem).padStart(2,'0'); if(tRem===0) ping();},1000); ping();

// ===== Parallax & reveal =====
const layers=document.querySelectorAll('[data-parallax]');
function onScroll(){const y=window.scrollY||0;layers.forEach(el=>{const s=parseFloat(el.dataset.parallax||'0.2'); el.style.transform=`translate3d(0, ${y*s}px, 0)`;});}
window.addEventListener('scroll',onScroll,{passive:true}); onScroll();

// ===== Two Engines sim (renamed to Maker/Saver) =====
function initEngines(){
  const FIRST_BASE=['Ava','Noah','Sophia','Liam','Isabella','Elijah','Mia','Lucas','Amelia','Mason','Harper','Logan','James','Olivia','Ethan','Grace','Wyatt','Nora','Caleb','Thea','Henry','Chloe','Levi','Ellie','Daniel','Stella','Owen','Layla','Jack','Zoe'];
  const LAST_BASE=['Smith','Johnson','Williams','Brown','Jones','Miller','Davis','Garcia','Wilson','Moore','Taylor','Anderson','Thomas','Jackson','White','Martin','Lee','Thompson','Walker','Young'];
  const ADJ=['Green','Rapid','Prime','North','West','Blue','Golden','Silver','Peak','Quantum','River','Bright','Union','Apex','Atlas','Metro','Nova','Ultra','Summit','Vertex'];
  const NOUN=['Pack','Box','Crate','Pallet','Label','Wrap','Carton','Foam','Seal','Ship','Flex','Film','Roll','Tray','Insert','Kit','Bundle','Supply','Works','Labs'];
  const CATS=['Flexible','Corrugated','Labels','Folding Cartons','Pallet/Crate'];
  const KW=['stand-up pouches','custom mailer boxes','rollstock quote','GHS label set','tray and insert','barrier bag','spout pouch','litho-lam carton'];
  const rand=a=>a[(Math.random()*a.length)|0];
  const many=(base,extra)=>{const out=[...base];for(let i=0;i<extra;i++){out.push(base[i%base.length]+String.fromCharCode(65+(i%26)))}return out};
  const FIRST=many(FIRST_BASE,90), LAST=many(LAST_BASE,90);
  const COS=[]; for(let i=0;i<200;i++){COS.push(rand(ADJ)+rand(NOUN))}
  const set=(id,val)=>{const el=document.getElementById(id); if(el) el.textContent=val};
  const feed=(el,html,tag)=>{const d=document.createElement('div');d.className='row';d.dataset.k=tag||'';d.innerHTML=html;el.insertBefore(d,el.firstChild);while(el.children.length>60)el.lastElementChild.remove()};
  function diurnalWindowRange(){const h=new Date().getHours(); if(h>=9&&h<=16) return [800,2400]; if((h>=7&&h<9) || (h>16&&h<=19)) return [300,900]; if(h>=20&&h<=22) return [120,380]; return [25,140];}
  function diurnalTasksRange(){const h=new Date().getHours(); if(h>=9&&h<=16) return [180,520]; if((h>=7&&h<9) || (h>16&&h<=19)) return [80,220]; if(h>=20&&h<=22) return [30,120]; return [10,60];}

  const now=()=>Date.now();
  const mk={winDur:30000, winStart:now(), target:0, leadsWin:0, hotPct:0.05, handoffShare:0.88, firstSec:10, quoteSec:28, repCloseRate:0.28, aiCloseRate:0.14, repClosedWin:0, aiClosedWin:0};
  const sv={winDur:30000, winStart:now(), target:0, tasksWin:0, saved:14200, auto:62, internal:40, quotes:18, qacc:99.2, csat:8, hours:42, churn:4};
  function newMk(){const [a,b]=diurnalWindowRange();mk.target=Math.floor(a+Math.random()*(b-a));mk.leadsWin=0;mk.repClosedWin=0;mk.aiClosedWin=0;mk.winStart=now();mk.hotPct=0.03+Math.random()*0.04}
  function newSv(){const [a,b]=diurnalTasksRange();sv.target=Math.floor(a+Math.random()*(b-a));sv.tasksWin=0;sv.winStart=now()}
  newMk(); newSv();

  const mkFeed=document.getElementById('mk_feed');
  const svFeed=document.getElementById('sv_feed');

  function tickMk(){
    const left=Math.max(0, Math.ceil((mk.winDur-(now()-mk.winStart))/1000)); set('mk_window', left+'s left'); if(left===0) newMk();
    const mean=mk.target/30, jitter=mean*0.35, add=Math.max(0, Math.round(mean + (Math.random()*jitter - jitter/2)));
    mk.leadsWin=Math.min(999999, mk.leadsWin+add);
    mk.firstSec=Math.max(3, Math.round(mk.firstSec*0.75 + Math.random()*6));
    mk.quoteSec=Math.max(6, Math.round(mk.quoteSec*0.85 + Math.random()*10));
    const hot=Math.round(mk.leadsWin*mk.hotPct), passed=Math.round(hot*mk.handoffShare), aiRouted=Math.max(0, hot-passed);
    mk.repClosedWin=Math.min(passed, Math.round(passed*mk.repCloseRate));
    mk.aiClosedWin=Math.min(aiRouted, Math.round(aiRouted*mk.aiCloseRate));
    set('mk_leads', mk.leadsWin); set('mk_hot', hot); set('mk_first', mk.firstSec+' sec');
    set('mk_passed', passed+' ('+(hot?Math.round(passed/hot*100):0)+'%)'); set('mk_ai', aiRouted+' ('+(hot?Math.round(aiRouted/hot*100):0)+'%)');
    set('mk_handoff', hot?Math.round(passed/hot*100)+'%':'—'); set('mk_rep_closed', mk.repClosedWin+' ('+Math.round(mk.repCloseRate*100)+'%)');
    set('mk_ai_closed', mk.aiClosedWin+' ('+Math.round(mk.aiCloseRate*100)+'%)'); set('mk_quote_sec', mk.quoteSec+' sec');
    const name=rand(FIRST)+' '+rand(LAST), co=rand(COS), cat=rand(CATS), kw=rand(KW);
    const r=Math.random(); let evt='route'; if(r<0.08)evt='find'; else if(r<0.16)evt='hot'; else if(r<0.32)evt='first'; else if(r<0.62)evt='route'; else if(r<0.82)evt='quote'; else evt='close';
    let line='';
    if(evt==='find'){ line=`<strong>${name}</strong> • ${cat} • “${kw}” • Found @ ${co}`; }
    else if(evt==='hot'){ line=`<strong>${name}</strong> • ${cat} • “${kw}” • Hot lead tagged`; }
    else if(evt==='first'){ line=`<strong>${name}</strong> • ${cat} • First touch in <b>${mk.firstSec}s</b>`; }
    else if(evt==='route'){ line=Math.random()<0.5?`<strong>${name}</strong> • ${cat} • Sent to human closer @ ${co}`:`<strong>${name}</strong> • ${cat} • Sent to AI closer @ ${co}`; }
    else if(evt==='quote'){ line=`<strong>${name}</strong> • ${cat} • Quoted in <b>${mk.quoteSec}s</b>`; }
    else { line=Math.random()<0.5?`<strong>${name}</strong> • ${cat} • Rep closed (of hot)`:`<strong>${name}</strong> • ${cat} • AI closed (of hot)`; }
    feed(mkFeed,line, evt);
  }

  function tickSv(){
    const left=Math.max(0, Math.ceil((sv.winDur-(now()-sv.winStart))/1000)); set('sv_window', left+'s left'); if(left===0) newSv();
    const mean=sv.target/30, jitter=mean*0.4, add=Math.max(0, Math.round(mean + (Math.random()*jitter - jitter/2)));
    sv.tasksWin=Math.min(999999, sv.tasksWin+add);
    sv.saved=Math.max(8000, sv.saved + (Math.random()*3000|0) - (Math.random()*1400|0));
    sv.auto=Math.min(97, Math.max(40, sv.auto + (Math.random()*5|0) - (Math.random()*3|0)));
    sv.internal+= (1+Math.random()*6|0); sv.quotes+= (Math.random()*4|0); sv.qacc=98 + Math.random()*2;
    sv.csat=Math.max(2, Math.min(25, sv.csat + (Math.random()<0.6?0.2:-0.1))); sv.hours+= (1+Math.random()*3|0);
    sv.churn=Math.max(1, Math.min(15, sv.churn + (Math.random()<0.5?-0.2:0.2)));
    set('sv_saved', '$'+sv.saved.toLocaleString()); set('sv_tasks', sv.tasksWin); set('sv_auto', sv.auto+'%');
    set('sv_internal', sv.internal); set('sv_quotes', sv.quotes); set('sv_qacc', sv.qacc.toFixed(1)+'%'); set('sv_csat', (sv.csat.toFixed(1))+'%'); set('sv_hours', sv.hours); set('sv_churn', (sv.churn.toFixed(1))+'%');
    const COS=['FreshPack','BoxPro','GreenCrate','RapidShip','PalletCo','SnackWorks','LabelLab','PrimeFlex','NorthSeal','BlueCarton','UnionPack','NovaRoll'];
    const roles=['VA','Data entry','SDR','CSR'];
    const flows=[
      {k:'auto',  t: `${rand(COS)} • AI automated Google Ads → Website → Email → Team notified → Follow-up set`},
      {k:'retain',t: `${rand(COS)} • AI automated Quote → Email → Lead notified → CRM updated`},
      {k:'support',t:`${rand(COS)} • Support auto-reply → Issue resolved`},
      {k:'retain',t:`${rand(COS)} • Inventory low → Reorder email scheduled`},
      {k:'savings',t:`${rand(COS)} • Removed ${(1+Math.random()*2|0)}× ${rand(roles)} from manual triage`}
    ];
    const pick=flows[(Math.random()*flows.length)|0]; feed(svFeed,pick.t,pick.k);
  }

  tickMk(); tickSv(); setInterval(tickMk,1000); setInterval(tickSv,1000);

  const focusState={maker:null, saver:null};
  function setEngineFocus(engineId,key){
    const eng=document.getElementById(engineId); if(!eng) return;
    const chips=eng.querySelectorAll('.chip'); chips.forEach(c=>c.classList.toggle('active', c.dataset.kpi===key));
    const kpis=eng.querySelectorAll('.kpi'); kpis.forEach(k=>{ if(!key){k.classList.remove('dim','active')} else {const match=(k.dataset.k===key); k.classList.toggle('active',match); k.classList.toggle('dim',!match);}});
    const rows=eng.querySelectorAll('.feed .row'); rows.forEach(r=>{ if(!key){r.classList.remove('dim')} else {r.classList.toggle('dim', (r.dataset.k||'')!==key)} });
    focusState[engineId]=key||null;
  }
  function clearFocus(engineId){ setEngineFocus(engineId,null); }
  function wireChips(engineId, chipsId){
    const group=document.getElementById(chipsId); if(!group) return;
    group.addEventListener('click',e=>{
      const chip=e.target.closest('.chip'); if(!chip) return;
      const key=chip.dataset.kpi; const isActive=chip.classList.contains('active');
      if(isActive){ clearFocus(engineId); } else { setEngineFocus(engineId,key); }
      e.stopPropagation();
    });
  }
  wireChips('maker','mk_chips'); wireChips('saver','sv_chips');
  document.addEventListener('click',e=>{ if(!e.target.closest('#maker')) clearFocus('maker'); if(!e.target.closest('#saver')) clearFocus('saver'); });
}

document.addEventListener('DOMContentLoaded',initEngines);
</script>
</body>
</html>
