<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Galactly — Leads</title>
<link rel="stylesheet" href="style.css"/>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:#0b0e18;color:#fff;margin:0}
  header{position:sticky;top:0;background:#0c1022;border-bottom:1px solid rgba(255,255,255,.08);padding:10px 16px}
  main{max-width:1000px;margin:20px auto;padding:0 16px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  input,select,button{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#0f142b;color:#fff}
  input[type="text"]{min-width:280px}
  button{cursor:pointer}
  ul{list-style:none;padding:0;margin:18px 0}
  li{padding:12px 10px;border:1px solid rgba(255,255,255,.08);border-radius:12px;margin-bottom:10px;background:linear-gradient(180deg,#0b1025,#0a0f1f)}
  a{color:#86f7d6;text-decoration:none}
  small{opacity:.85}
</style>
</head>
<body>
<header>
  <div class="row">
    <input id="q" placeholder="query" value="packaging buyer" style="flex:1"/>
    <input id="limit" type="number" min="1" max="20" value="12" style="width:90px"/>
    <button id="search">Search</button>
  </div>
</header>
<main>
  <ul id="list"></ul>
</main>
<script src="api-base.js"></script>
<script>
  const $ = s => document.querySelector(s);
  async function run(){
    const base = (window.API_BASE||'').replace(/\/+$/,'');
    if(!base){ alert('API base not set'); return; }
    const q = encodeURIComponent($('#q').value.trim());
    const limit = Math.max(1, Math.min(parseInt($('#limit').value||'12',10), 20));
    const url = `${base}/api/v1/leads?limit=${limit}&q=${q}`;
    const res = await fetch(url);
    let data;
    if(!res.ok){
      const text = await res.text().catch(()=> '');
      data = {leads:[], _error:`${res.status} ${res.statusText} :: ${text.slice(0,200)}`};
    }else{
      data = await res.json();
    }
    const ul = $('#list'); ul.innerHTML='';
    if (data._error){
      const li = document.createElement('li');
      li.innerHTML = `<small style="color:#f88">Error: ${data._error}</small>`;
      ul.appendChild(li);
      return;
    }
    (data.leads||data.items||[]).forEach(it=>{
      const title = it.kw || it.title || it.url || 'Lead';
      const url = it.url || '#';
      const line2 = [it.platform, it.region, it.heat].filter(Boolean).join(' • ');
      const li = document.createElement('li');
      li.innerHTML = `<a href="${url}" target="_blank" rel="noopener">${title}</a><br/>
                      <small>${line2}</small>`;
      ul.appendChild(li);
    });
    if(!(data.leads||data.items||[]).length){
      const li = document.createElement('li');
      li.innerHTML = `<small>No results yet. Try another query.</small>`;
      ul.appendChild(li);
    }
  }
  $('#search').onclick = run;
  run();
</script>
</body>
</html>
