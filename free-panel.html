<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Galactly — Live packaging leads</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
<style>
:root{--bg:#0a0d16;--card:#0c1022;--ink:#e8eefb;--mut:#9aa3b2;--line:rgba(255,255,255,.10);--accent:#86f7d6;--accent2:#57a4ff}
*{box-sizing:border-box} html,body{height:100%} body{margin:0;background:linear-gradient(180deg,#0b0e18,#080a12);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
.header{position:sticky;top:0;z-index:20;display:flex;gap:14px;align-items:center;padding:16px 18px;border-bottom:1px solid var(--line);backdrop-filter:blur(10px) saturate(1.1);background:rgba(5,8,13,.55)}
.header b{font-weight:800}
.header .mut{color:var(--mut)}
.header .spacer{flex:1}
.header .pill{border:1px solid var(--line);border-radius:999px;padding:6px 10px;font-size:12px;color:var(--mut)}
.header .close{background:rgba(255,255,255,.06);border:1px solid var(--line);color:#fff;padding:8px 12px;border-radius:12px;text-decoration:none;font-weight:700}
.wrap{max-width:1260px;margin:0 auto;padding:18px}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
@media (max-width:1260px){.grid{grid-template-columns:repeat(3,1fr)}}
@media (max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}}
@media (max-width:640px){.grid{grid-template-columns:1fr}}
.card{background:linear-gradient(180deg,#0c1226,#0a0f20);border:1px solid var(--line);border-radius:16px;padding:16px;display:flex;flex-direction:column;gap:10px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
.card h3{margin:0;font:800 16px/1.3 Montserrat,Inter}
.card p{margin:0;color:var(--mut);font-size:13px;line-height:1.5}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.tag{font-size:12px;border:1px solid var(--line);border-radius:999px;padding:6px 10px;color:var(--mut)}
.origin{font-size:12px;background:rgba(255,255,255,.06);border:1px solid var(--line);border-radius:999px;padding:6px 10px;color:#fff;text-decoration:none}
.why{display:flex;gap:8px;align-items:center;color:var(--mut);font-size:13px;cursor:pointer}
.why i{display:inline-flex;width:18px;height:18px;align-items:center;justify-content:center;border:1px solid var(--line);border-radius:50%;font-style:normal;font-weight:800;color:#fff}
.reason{display:none;margin-top:8px;color:#cfd6e7;font-size:13px;border-left:2px solid var(--accent);padding-left:10px}
.card.open .reason{display:block}


/* Onboarding gate */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(5,8,13,.55);backdrop-filter:blur(8px);z-index:50}
.modal.show{display:flex}
.sheet{width:min(560px,92vw);background:linear-gradient(180deg,#0d1329,#0b1022);border:1px solid var(--line);border-radius:20px;padding:22px 20px;box-shadow:0 20px 60px rgba(0,0,0,.55)}
.sheet h2{margin:0 0 6px;font:800 22px Montserrat,Inter}
.sheet p{margin:0 0 16px;color:var(--mut)}
.f{display:flex;flex-direction:column;gap:12px}
.input{display:flex;flex-direction:column;gap:6px}
.input input{background:#0a1022;border:1px solid var(--line);color:#fff;border-radius:12px;padding:12px}
.chk{display:flex;gap:10px;align-items:flex-start;color:var(--mut);font-size:14px}
.chk input{margin-top:2px}
.website{max-height:0;overflow:hidden;transition:max-height .25s ease}
.website.show{max-height:80px}
.actions{display:flex;gap:10px;justify-content:flex-end;margin-top:6px}
.btn{padding:12px 16px;border-radius:12px;border:1px solid var(--line);font-weight:800}
.btn.primary{background:linear-gradient(90deg,#ffffff,#e9f0ff);color:#111}



.empty{opacity:.75;border:1px dashed var(--line);border-radius:16px;padding:20px;text-align:center}
</style>
</head>
<body>
<div class="header">
<b>Live feed</b>
<span class="mut">·</span>
<span class="mut" id="refreshIn">refresh in 25s</span>
<div class="spacer"></div>
<span class="pill" id="online">— online</span>
<a class="close" href="./index.html">Close</a>
</div>
<div class="wrap">
<div id="grid" class="grid"></div>
<div id="empty" class="empty" style="display:none">No items. Check API key / CSE IDs on backend.</div>
</div>


<!-- Onboarding (gates the feed) -->
<div id="gate" class="modal">
<div class="sheet">
<h2>Tell us who to prioritize</h2>
<p>30s setup. Clicks only. You’ll unlock the live feed after verifying your email.</p>
<form class="f" id="gateForm">
<div class="input"><label>Email</label><input id="email" type="email" required placeholder="you@company.com"/></div>
<label class="chk"><input id="listMe" type="checkbox"/> <span>Also list my company for inbound opportunities from my ICPs.</span></label>
<div class="website" id="websiteWrap"><div class="input"><label>Company website</label><input id="site" type="url" placeholder="https://example.com"/></div></div>
<div class="actions">
<button type="submit" class="btn primary">Save & unlock</button>
</div>
</form>
</div>
</div>


<script>
// --- api-base.js loader (inlined, same as separate file) ---
(function(){
if(window.API_BASE) return; // already set
const DEF='https://p01--animated-cellar--vz4ftkwrzdfs.code.run';
const param=new URLSearchParams(location.search).get('api');
let base=(localStorage.getItem('apiBase')||'').trim()||(param||'').trim()||DEF;
if(!/^https?:\/\//i.test(base)) base='https://'+base; base=base.replace(/\/$/,'');
window.API_BASE=base; const _f=window.fetch.bind(window);
window.fetch=(input,init)=>{const u=typeof input==='string'?input:input.url; if(u&&/^\/api\/v1\//.test(u)) return _f(window.API_BASE+u,init); return _f(input,init)};
console.log('[api-base] API_BASE =', window.API_BASE);
})();


// --- Gate logic ---
const gate=document.getElementById('gate');
const gateForm=document.getElementById('gateForm');
const websiteWrap=document.getElementById('websiteWrap');
const listMe=document.getElementById('listMe');
listMe.addEventListener('change',()=>websiteWrap.classList.toggle('show',listMe.checked));
function showGate(){gate.classList.add('show')} function hideGate(){gate.classList.remove('show')}
const KEY='galactly_optin_v1';
if(!localStorage.getItem(KEY)) showGate();


gateForm.addEventListener('submit',async(ev)=>{
ev.preventDefault();
const email=(document.getElementById('email').value||'').trim();
const site=(document.getElementById('site').value||'').trim();
if(!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)) return alert('Enter a valid email');
localStorage.setItem(KEY, JSON.stringify({email,listMe:listMe.checked,site}));
hideGate();
// Optional: hit a lightweight event endpoint later
loadFeed(true);
});

  // --- Live feed ---
const grid=document.getElementById('grid');
const empty=document.getElementById('empty');
const refreshEl=document.getElementById('refreshIn');
const onlineEl=document.getElementById('online');
let countdown=25, timer=null;


function tag(label){const span=document.createElement('span'); span.className='tag'; span.textContent=label; return span}
function origin(href,txt){const a=document.createElement('a'); a.className='origin'; a.href=href; a.target='_blank'; a.rel='noopener'; a.textContent=txt; return a}
function explain(it){ // heuristic reasons
const t=(it.title||'').toLowerCase(); const s=(it.snippet||'').toLowerCase();
const cues=['rfp','rfq','bid','vendor','supplier','packaging','pallet','box','carton','label','fulfillment','contract','buy','procure'];
const hits=cues.filter(k=>t.includes(k)||s.includes(k));
const host=it.displayLink||new URL(it.url).host;
let why=`Signals on ${host}: `+ (hits.length? hits.slice(0,4).join(', '):'engagement spike / buyer intent keywords');
return why+ (it.url?` · <a class="origin" href="${it.url}" target="_blank" rel="noopener">open source</a>`:'');
}


function card(it){
const el=document.createElement('div'); el.className='card';
const h=document.createElement('h3'); h.innerHTML=it.title||it.url; el.appendChild(h);
const p=document.createElement('p'); p.textContent=it.snippet||''; el.appendChild(p);
const row=document.createElement('div'); row.className='row';
row.appendChild(tag(it.source||'web'));
row.appendChild(origin(it.url, it.displayLink||new URL(it.url).host));
el.appendChild(row);
const why=document.createElement('div'); why.className='why'; why.innerHTML='<i>i</i> Why AI shows you this lead?'; el.appendChild(why);
const reason=document.createElement('div'); reason.className='reason'; reason.innerHTML=explain(it); el.appendChild(reason);
why.addEventListener('click',()=>el.classList.toggle('open'));
return el;
}


async function fetchJSON(u){try{const r=await fetch(u,{headers:{'accept':'application/json'}}); if(!r.ok) return null; return await r.json()}catch(_){return null}}


async function loadFeed(force){
clearInterval(timer); countdown=25; tickCountdown(); timer=setInterval(tickCountdown,1000);
const q='packaging buyers RFP';
// Prefer /leads, fallback to /peek
let data=await fetchJSON(`/api/v1/leads?limit=24&q=${encodeURIComponent(q)}`);
if(!data||!Array.isArray(data.items)||!data.items.length){
data=await fetchJSON(`/api/v1/peek?type=web&limit=24&q=${encodeURIComponent(q)}`);
}
const items=data&&Array.isArray(data.items)?data.items:[];
grid.innerHTML='';
if(!items.length){ empty.style.display='block'; return } else empty.style.display='none';
items.forEach(it=>{try{grid.appendChild(card(it))}catch(e){}});
const n=items.length; onlineEl.textContent = `${Math.max(7,Math.min(99,Math.floor(n*1.4)))} online`;
}


function tickCountdown(){ refreshEl.textContent=`refresh in ${countdown--}s`; if(countdown<=0){loadFeed();} }


// Kick off after gate if already opted in
if(localStorage.getItem(KEY)) loadFeed();
</script>
</body>
</html>
