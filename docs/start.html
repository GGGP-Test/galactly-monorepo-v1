<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Galactly — Onboarding</title>

  <!--
    THEME NOTES
    - Gradient background + glass UI inspired by the 21st.dev example (reimplemented from scratch).
    - Step 1 keeps the Buyer/Supplier choice, but no big outer card; just clean, glassy elements.
    - Step 2 is minimalist: email-only entry with arrow, derived website is shown as plain text (no chip).
    - Titles use the same font treatment as your Section 3 `.proc-title` (with fallbacks if that CSS isn't present here).
    - No "Ready" chips anywhere. Home icon at top-right returns to the landing page.
    - Validations: no personal email (gmail.com, yahoo.com, etc.) and domain must match website.
      Redirect/forwarding checks are stubbed (CORS limits in browser) but the UX + hook is here.
    - Hooks to optional `window.onboarding` object so you can wire server/API flows in `onboarding.common.js`.
  -->

  <style>
    :root{
      /* Brand palette (tune freely) */
      --bg-1: #0a0f1c;          /* deep navy */
      --bg-2: #0d1224;          /* slightly lighter navy */
      --fg-1: #e9ecf3;          /* foreground text */
      --fg-2: #9aa3b2;          /* secondary text */
      --accent: #f4d06f;        /* gold accent */
      --accent-2: #6ad2ff;      /* electric blue accent */
      --glass: rgba(255,255,255,0.06);
      --glass-strong: rgba(255,255,255,0.12);
      --ring: rgba(255,255,255,0.25);
      --error: #ff6b6b;
      --ok: #66d19e;

      /* Heading font fallback: tries to mirror your .proc-title */
      --heading-family: var(--proc-title-font, var(--font-heading, ui-serif, "Times New Roman", Georgia, serif));
      --heading-weight: var(--proc-title-weight, 600);
      --heading-ls: -0.02em;
    }

    html, body{
      height:100%;
      background: radial-gradient(1200px 800px at 75% 25%, #201437 0%, transparent 55%),
                  radial-gradient(1200px 800px at 25% 75%, #3c1029 0%, transparent 55%),
                  linear-gradient(180deg, var(--bg-2), var(--bg-1));
      color:var(--fg-1);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", "Noto Sans", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      margin:0;
    }

    /* Subtle animated blobs */
    .bg-blob{
      position: fixed; inset: 0; z-index: 0; pointer-events: none; overflow: hidden;
    }
    .blob{ position:absolute; filter: blur(70px); opacity:.55; mix-blend-mode:screen; }
    .b1{ width:42vmax; height:42vmax; background:#3a5bd7; top:-10vmax; left:-10vmax; border-radius:45% 55% 60% 40%; animation:float1 18s ease-in-out infinite; }
    .b2{ width:35vmax; height:35vmax; background:#b33e85; bottom:-8vmax; right:-10vmax; border-radius:50% 50% 45% 55%; animation:float2 22s ease-in-out infinite; }
    .b3{ width:26vmax; height:26vmax; background:#f4d06f; top:40%; left:60%; border-radius:60% 40% 50% 50%; opacity:.35; animation:float3 26s ease-in-out infinite; }
    @keyframes float1{ 0%{transform:translate(0,0)} 50%{transform:translate(-18px,12px)} 100%{transform:translate(0,0)} }
    @keyframes float2{ 0%{transform:translate(0,0)} 50%{transform:translate(20px,-10px)} 100%{transform:translate(0,0)} }
    @keyframes float3{ 0%{transform:translate(0,0)} 50%{transform:translate(-14px,-18px)} 100%{transform:translate(0,0)} }

    /* Top chrome (no header bar—just logo left, home icon right) */
    .topbar{
      position:fixed; top:16px; left:0; right:0; z-index:10;
      display:flex; align-items:center; justify-content:space-between;
      padding:0 18px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      text-decoration:none; color:var(--fg-1);
      padding:8px 10px; border-radius:12px;
      backdrop-filter: blur(6px);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.12);
    }
    .brand img{ height:22px; width:auto; display:block; }
    .brand span{ font-weight:700; letter-spacing:-0.01em; font-size:14px; opacity:.95; }

    .home-link{
      display:inline-flex; align-items:center; justify-content:center;
      width:36px; height:36px; border-radius:10px;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.14);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06), 0 10px 25px rgba(0,0,0,.2);
      color: var(--fg-1); text-decoration:none;
      backdrop-filter: blur(6px);
      transition:transform .2s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .home-link:hover{ transform:translateY(-1px); border-color:rgba(255,255,255,.22); box-shadow: inset 0 1px 0 rgba(255,255,255,.1), 0 14px 32px rgba(0,0,0,.25); }
    .home-link svg{ width:18px; height:18px; }

    /* Layout */
    .wrap{
      position:relative; z-index:1;
      min-height:100dvh; display:grid; place-items:center;
      padding:96px 16px 40px;
    }
    .stage{ width:min(980px, 92vw); margin-inline:auto; }

    /* Title style = Section 3 proc-title look (reuse class name to inherit if present) */
    .title, .proc-title{
      font-family: var(--heading-family);
      font-weight: var(--heading-weight);
      letter-spacing: var(--heading-ls);
      font-size: clamp(28px, 4.2vw, 44px);
      line-height: 1.08;
      margin: 0 0 18px 0;
      text-shadow: 0 1px 0 rgba(0,0,0,.35);
    }
    .subtitle{ color:var(--fg-2); margin:0 0 22px 0; }

    /* Glass select cards (Step 1) */
    .choices{
      display:grid; grid-template-columns: 1fr; gap:16px;
    }
    @media (min-width:720px){ .choices{ grid-template-columns: 1fr 1fr; } }
    .choice{
      position:relative; border-radius:16px; padding:18px 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.035));
      border:1px solid rgba(255,255,255,.15);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08), 0 10px 30px rgba(0,0,0,.25);
      cursor:pointer; user-select:none;
      display:flex; gap:14px; align-items:flex-start;
      transition: transform .18s ease, border-color .18s ease, box-shadow .18s ease;
    }
    .choice:hover{ transform:translateY(-2px); border-color:rgba(255,255,255,.25); box-shadow: inset 0 1px 0 rgba(255,255,255,.1), 0 16px 42px rgba(0,0,0,.28); }
    .choice.selected{ outline:2px solid var(--accent); box-shadow: 0 0 0 6px rgba(244,208,111,.15), 0 14px 40px rgba(244,208,111,.18); }
    .choice h3{
      margin:0 0 6px 0; font-size:18px;
      font-weight:700; letter-spacing:-0.01em;
    }
    .choice p{ margin:0; color:var(--fg-2); font-size:14px; line-height:1.35; }
    .choice .icon{
      display:inline-flex; align-items:center; justify-content:center;
      width:38px; height:38px; border-radius:12px;
      background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.05));
      border:1px solid rgba(255,255,255,.18);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.1), 0 8px 20px rgba(0,0,0,.25);
      flex:0 0 auto;
    }
    .choice .icon svg{ width:18px; height:18px; }

    /* Arrow buttons (no NEXT text) */
    .row-actions{ display:flex; justify-content:space-between; gap:12px; margin-top:14px; }
    .btn-icon{
      display:inline-flex; align-items:center; justify-content:center;
      width:44px; height:44px; border-radius:999px; color:var(--fg-1);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.18);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.1), 0 10px 26px rgba(0,0,0,.24);
      backdrop-filter: blur(6px);
      cursor:pointer;
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease, opacity .18s ease;
    }
    .btn-icon[disabled]{ opacity:.4; pointer-events:none; }
    .btn-icon:hover{ transform: translateY(-1px); border-color:rgba(255,255,255,.26); box-shadow: inset 0 1px 0 rgba(255,255,255,.14), 0 16px 38px rgba(0,0,0,.28); }
    .btn-icon svg{ width:20px; height:20px; }

    /* Step blocks */
    .cardless{ max-width:860px; margin-inline:auto; }
    .step{ display:none; }
    .step.active{ display:block; }

    /* Glass input */
    .glass-input{
      display:flex; align-items:center; gap:10px; padding:10px 12px;
      border-radius:999px; border:1px solid rgba(255,255,255,.16);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08), 0 10px 26px rgba(0,0,0,.24);
      backdrop-filter: blur(6px);
    }
    .glass-input input{
      flex:1; min-width:0; background:transparent; border:0; outline:0;
      color:var(--fg-1); font-size:14px;
    }
    .glass-input input::placeholder{ color: rgba(233,236,243,.60); }
    .glass-input .right{ display:flex; align-items:center; gap:8px; }

    /* Step 2 presentation */
    .bigline{ margin:10px 0 6px 4px; font-size:15px; color:var(--fg-2); }
    .bigline b{ color:var(--fg-1); font-size: clamp(16px, 2.6vw, 20px); letter-spacing:-0.01em; }
    .hint{ color:var(--fg-2); font-size:12px; margin:6px 4px 0; }

    /* Inline error + learn more */
    .error{ color:var(--error); font-size:13px; margin:8px 4px 0; display:flex; align-items:center; gap:8px; }
    .learn{ position:relative; display:inline-flex; align-items:center; gap:6px; cursor:help; color:var(--accent-2); }
    .tooltip{ position:absolute; left:0; top:calc(100% + 8px); width:min(88vw, 320px); background:rgba(16,20,36,.96); border:1px solid rgba(255,255,255,.14);
      color:var(--fg-1); border-radius:12px; padding:10px 12px; box-shadow:0 24px 60px rgba(0,0,0,.4); display:none; z-index:20; }
    .tooltip ul{ padding-left:18px; margin:6px 0; }
    .tooltip li{ margin:6px 0; color:var(--fg-2); font-size:13px; }
    .learn.open .tooltip{ display:block; }

    /* Utility */
    .hide{ display:none !important; }
    .mt-8{ margin-top: 8px; }
    .mt-16{ margin-top: 16px; }
    .mt-24{ margin-top: 24px; }
  </style>
</head>
<body>

  <div class="bg-blob" aria-hidden="true">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
  </div>

  <!-- Minimal chrome (logo left, home at right) -->
  <div class="topbar">
    <a class="brand" href="#" aria-label="Galactly">
      <!-- We try multiple likely logo locations; JS below will pick the first that loads -->
      <img id="brandLogo" alt="Galactly" src="" />
      <span>Galactly</span>
    </a>
    <a class="home-link" href="index.html" aria-label="Back to home">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M3 11L12 3l9 8"></path>
        <path d="M9 22V12h6v10"></path>
      </svg>
    </a>
  </div>

  <main class="wrap">
    <div class="stage cardless">

      <!-- STEP 1 -->
      <section id="step1" class="step active" aria-labelledby="s1-title">
        <h1 id="s1-title" class="title proc-title">What brings you to Galactly?</h1>
        <p class="subtitle">Pick one to tailor your setup.</p>

        <div class="choices" role="listbox" aria-label="Select your role">
          <div class="choice" data-role="supplier" tabindex="0" role="option" aria-selected="false">
            <div class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 7h18v10H3z"></path><path d="M16 7V3H8v4"></path>
              </svg>
            </div>
            <div>
              <h3>Supplier — I sell packaging</h3>
              <p>Capture buyers already signaling intent, prioritize by timing, and let smart outreach run on autopilot.</p>
            </div>
          </div>

          <div class="choice" data-role="buyer" tabindex="0" role="option" aria-selected="false">
            <div class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 12.39a2 2 0 0 0 2 1.61h8.72a2 2 0 0 0 2-1.58L23 6H6"></path>
              </svg>
            </div>
            <div>
              <h3>Buyer — I buy packaging</h3>
              <p>Describe your need once—get matched to vetted suppliers fast, with clear timelines and quotes.</p>
            </div>
          </div>
        </div>

        <div class="row-actions mt-16">
          <button type="button" id="s1-back" class="btn-icon" aria-label="Go back" disabled>
            <!-- left arrow -->
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M15 18l-6-6 6-6"></path>
            </svg>
          </button>
          <button type="button" id="s1-next" class="btn-icon" aria-label="Continue" disabled>
            <!-- right arrow -->
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 18l6-6-6-6"></path>
            </svg>
          </button>
        </div>
      </section>

      <!-- STEP 2 -->
      <section id="step2" class="step" aria-labelledby="s2-title">
        <h1 id="s2-title" class="title proc-title">Tell us who you are</h1>

        <!-- Derived website (plain text, no chip) -->
        <div id="derivedLine" class="bigline hide">Website we’ll use: <b id="derivedWebsite"></b></div>

        <!-- Email input with arrow-only submission -->
        <div class="glass-input mt-16" role="group" aria-label="Business email">
          <input id="email" type="email" inputmode="email" autocomplete="email"
                 placeholder="Business email (no personal Gmail, etc.)" aria-describedby="emailHint">
          <div class="right">
            <button type="button" class="btn-icon" id="email-go" aria-label="Continue with email" disabled>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 18l6-6-6-6"></path>
              </svg>
            </button>
          </div>
        </div>
        <div id="emailHint" class="hint">Use your company address. Personal mail (gmail.com, yahoo.com, etc.) is blocked.</div>
        <div id="emailError" class="error hide">
          <span>Check your email.</span>
          <span class="learn" id="learnTrigger">Learn more
            <span class="tooltip" role="tooltip">
              <strong>What can block progress?</strong>
              <ul>
                <li>Personal domains (gmail.com, yahoo.com, outlook.com...).</li>
                <li>Website not reachable from the public internet.</li>
                <li>Your domain forwards to another site or a holding page.</li>
                <li>Domain doesn’t match your website.</li>
              </ul>
            </span>
          </span>
        </div>

        <!-- Website (read or inferred) -->
        <div class="glass-input mt-8" role="group" aria-label="Your website">
          <input id="website" type="url" inputmode="url" placeholder="Your website (https://example.com)">
        </div>
        <div class="hint">If you came from the landing CTA, this may already be pre-filled.</div>

        <!-- Back / Continue -->
        <div class="row-actions mt-16">
          <button type="button" id="s2-back" class="btn-icon" aria-label="Back to role">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M15 18l-6-6 6-6"></path>
            </svg>
          </button>
          <button type="button" id="finish" class="btn-icon" aria-label="Finish" disabled>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 18l6-6-6-6"></path>
            </svg>
          </button>
        </div>

        <!-- Validation messages -->
        <div id="domainMismatch" class="error hide">Your business email domain must match your website.</div>
        <div id="siteUnreachable" class="error hide">Your website looks unreachable or misconfigured.
          <span class="learn" id="learnTrigger2">Learn more
            <span class="tooltip" role="tooltip">
              <ul>
                <li>Make sure DNS is set and the site is public.</li>
                <li>Avoid forwarding/parking to another domain.</li>
                <li>Responds with HTTP 200 on the root path.</li>
                <li>Has basic content identifying you as a buyer or supplier.</li>
              </ul>
            </span>
          </span>
        </div>
      </section>

    </div>
  </main>

  <script>
    /* ---------- best-effort brand logo detection (uses first successful path) ---------- */
    (function tryLogo(){
      const candidates = [
        "/assets/logo/galactly-logo.svg",
        "/assets/logo/logo.svg",
        "/assets/brand/galactly-logo.svg",
        "/assets/branding/galactly-logo.svg",
        "/img/galactly-logo.svg",
        "/images/logo.svg",
        "/logo.svg",
        "/assets/logo.png",
        "/images/logo.png"
      ];
      const el = document.getElementById("brandLogo");
      let idx = 0;
      const testNext = () => {
        if(idx >= candidates.length){ el.remove(); return; }
        const src = candidates[idx++];
        const img = new Image();
        img.onload = () => { el.src = src; };
        img.onerror = testNext;
        img.src = src;
      };
      testNext();
    })();

    /* ---------- tiny helpers ---------- */
    const byId = (id)=>document.getElementById(id);
    const qs = (sel,root=document)=>root.querySelector(sel);
    const qsa = (sel,root=document)=>Array.from(root.querySelectorAll(sel));

    const step1 = byId("step1");
    const step2 = byId("step2");
    const s1Next = byId("s1-next");
    const s2Back = byId("s2-back");
    const finish = byId("finish");
    const emailInput = byId("email");
    const websiteInput = byId("website");
    const emailGo = byId("email-go");
    const derivedLine = byId("derivedLine");
    const derivedWebsite = byId("derivedWebsite");
    const emailError = byId("emailError");
    const domainMismatch = byId("domainMismatch");
    const siteUnreachable = byId("siteUnreachable");

    const personalDomains = new Set(["gmail.com","yahoo.com","outlook.com","hotmail.com","live.com","aol.com","icloud.com","proton.me","protonmail.com","yandex.com","gmx.com","mail.com","pm.me"]);
    const urlParams = new URLSearchParams(location.search);
    const preSite = urlParams.get("site") || localStorage.getItem("gal_site") || "";

    if(preSite){
      websiteInput.value = normalizeSite(preSite);
      updateDerivedFromWebsite();
    }

    /* ---------- STEP 1 select role ---------- */
    let role = null;
    qsa(".choice", step1).forEach(el=>{
      const r = el.getAttribute("data-role");
      const pick = () => {
        role = r;
        qsa(".choice", step1).forEach(c => {
          c.classList.toggle("selected", c === el);
          c.setAttribute("aria-selected", c === el ? "true" : "false");
        });
        s1Next.disabled = false;
        if(window.onboarding?.setRole) window.onboarding.setRole(role);
      };
      el.addEventListener("click", pick);
      el.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); pick(); } });
    });

    s1Next.addEventListener("click", ()=>{
      if(!role) return;
      step1.classList.remove("active");
      step2.classList.add("active");
      emailInput.focus();
      if(window.onboarding?.goTo) window.onboarding.goTo(2);
    });

    /* ---------- STEP 2 logic ---------- */
    function normalizeSite(value){
      try{
        let v = (value||"").trim();
        if(!v) return "";
        if(!/^https?:\/\//i.test(v)) v = "https://" + v;
        const u = new URL(v);
        return u.origin;
      }catch{ return ""; }
    }

    function extractDomainFromEmail(email){
      const m = /@([A-Za-z0-9.-]+\.[A-Za-z]{2,})$/.exec(String(email).trim());
      return m ? m[1].toLowerCase() : "";
    }

    function showDerived(domain){
      if(domain){
        derivedWebsite.textContent = "https://" + domain;
        derivedLine.classList.remove("hide");
      }else{
        derivedLine.classList.add("hide");
      }
    }

    function updateDerivedFromWebsite(){
      const site = normalizeSite(websiteInput.value);
      if(site){
        try{
          const host = new URL(site).host;
          showDerived(host);
        }catch{
          showDerived("");
        }
      }
    }

    websiteInput.addEventListener("input", ()=>{
      updateDerivedFromWebsite();
      validateEmailAndWebsite();
    });

    emailInput.addEventListener("input", ()=>{
      emailError.classList.add("hide");
      const domain = extractDomainFromEmail(emailInput.value);
      showDerived(domain);
      validateEmailAndWebsite();
      emailGo.disabled = !looksValidBusinessEmail(emailInput.value);
    });

    emailInput.addEventListener("keydown", (e)=>{
      if(e.key === "Enter"){
        e.preventDefault();
        if(!emailGo.disabled) emailGo.click();
      }
    });

    emailGo.addEventListener("click", ()=>{
      // advance cursor to website if empty, otherwise attempt finish-validations
      if(!websiteInput.value && derivedWebsite.textContent){
        websiteInput.value = derivedWebsite.textContent;
      }
      validateEmailAndWebsite(true);
    });

    s2Back.addEventListener("click", ()=>{
      step2.classList.remove("active");
      step1.classList.add("active");
      if(window.onboarding?.goTo) window.onboarding.goTo(1);
    });

    finish.addEventListener("click", async ()=>{
      // Final hook to your common.js (you can replace/no-op)
      const payload = {
        role,
        email: emailInput.value.trim(),
        website: normalizeSite(websiteInput.value)
      };
      try{
        if(window.onboarding?.submit) await window.onboarding.submit(payload);
        // fallback navigation (adjust):
        location.href = "step3.html";
      }catch(err){
        console.error(err);
        alert("Could not complete onboarding right now.");
      }
    });

    function looksValidBusinessEmail(email){
      email = String(email||"").trim();
      const at = email.indexOf("@");
      if(at < 1) return false;
      if(!/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(email)) return false;
      const domain = extractDomainFromEmail(email);
      if(personalDomains.has(domain)) return false;
      return true;
    }

    function validateEmailAndWebsite(raiseErrors){
      const emailOk = looksValidBusinessEmail(emailInput.value);
      const site = normalizeSite(websiteInput.value);
      const siteOk = !!site;

      // live mismatch check (domain must match website host)
      const emailDomain = extractDomainFromEmail(emailInput.value);
      let host = "";
      try{ host = site ? new URL(site).host.toLowerCase() : ""; }catch{ host = ""; }

      const domainMatches = emailDomain && host && (host.endsWith(emailDomain) || emailDomain.endsWith(host));

      // Reset messages
      emailError.classList.add("hide");
      domainMismatch.classList.add("hide");
      siteUnreachable.classList.add("hide");

      // Basic errors
      if(raiseErrors){
        if(!emailOk) emailError.classList.remove("hide");
        if(siteOk && !domainMatches) domainMismatch.classList.remove("hide");
      }

      // "Unreachable" heuristic stub (front-end only). Do lightweight HEAD ping where CORS allows.
      if(siteOk){
        tryReach(site).then(reachable => {
          if(raiseErrors && !reachable){
            siteUnreachable.classList.remove("hide");
          }
          finish.disabled = !(emailOk && domainMatches && reachable);
        }).catch(()=>{
          // Network errors => keep Finish disabled unless you prefer soft-allow.
          finish.disabled = true;
          if(raiseErrors) siteUnreachable.classList.remove("hide");
        });
      }else{
        finish.disabled = true;
      }

      // enable finish when obviously good and we haven't pinged yet
      if(!siteOk || !emailOk || !domainMatches){
        finish.disabled = true;
      }
      if(window.onboarding?.setEmail) window.onboarding.setEmail(emailInput.value.trim());
      if(window.onboarding?.setWebsite) window.onboarding.setWebsite(site);
    }

    async function tryReach(site){
      // Attempt a fast fetch; many sites will block with CORS, so treat opaque as "unknown".
      try{
        const res = await fetch(site, { method:"HEAD", mode:"no-cors", cache:"no-store" });
        // no-cors returns "opaque" type => we can't read status, assume likely reachable.
        return true;
      }catch(e){
        return false;
      }
    }

    // Learn-more tooltips (hover or tap)
    function setupLearn(id){
      const el = byId(id);
      if(!el) return;
      const toggle = (open) => el.classList.toggle("open", open);
      el.addEventListener("mouseenter", ()=>toggle(true));
      el.addEventListener("mouseleave", ()=>toggle(false));
      el.addEventListener("click", ()=>toggle(!el.classList.contains("open")));
    }
    setupLearn("learnTrigger");
    setupLearn("learnTrigger2");

    // Preselect role if present from query (?role=buyer|supplier)
    const qsRole = (urlParams.get("role")||"").toLowerCase();
    if(qsRole === "buyer" || qsRole === "supplier"){
      const target = qs(`.choice[data-role="${qsRole}"]`);
      if(target) target.click();
    }

    // Keep s1-next disabled until role chosen
    s1Next.disabled = true;
  </script>
</body>
</html>
