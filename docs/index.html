<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Buyers Finder</title>
  <style>
    :root{
      --bg:#0d1117; --panel:#111826; --panel2:#0f1623;
      --text:#d6e2f0; --muted:#9fb2c8; --accent:#7bd7ff;
      --cta:#67d1ff; --ctaText:#06141f; --line:#233146;
      --chip:#172131; --chipOn:#203147; --danger:#ff7b7b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:radial-gradient(1000px 520px at 50% -10%, #0f1a2a 0%, #0d1117 60%, #0b0f15 100%);
      color:var(--text);
      font:14px/1.45 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .hero{min-height:100vh; display:grid; place-items:center; padding:32px}
    .hero-inner{max-width:880px; text-align:center}
    h1{font-size:44px; line-height:1.08; margin:0 0 12px}
    h1 strong{color:#fff}
    p.sub{color:var(--muted); margin:0 0 28px}
    .cta{display:inline-block; padding:14px 22px; border-radius:12px; background:var(--cta); color:var(--ctaText);
      font-weight:800; text-decoration:none; box-shadow:0 8px 22px rgba(103,209,255,.25)}
    .cta:active{transform:translateY(1px)}

    /* Modal */
    .scrim{position:fixed; inset:0; display:none; align-items:center; justify-content:center; padding:24px; background:rgba(0,0,0,.55); z-index:50}
    .scrim.on{display:flex}
    .modal{width:min(960px,96vw); max-height:90vh; display:flex; flex-direction:column; background:var(--panel);
      border:1px solid var(--line); border-radius:16px; box-shadow:0 12px 50px rgba(0,0,0,.45)}
    .hd{display:flex; align-items:center; justify-content:space-between; gap:8px; padding:14px 16px; border-bottom:1px solid var(--line)}
    .tt{font-weight:800}
    .dots{display:flex; gap:6px; align-items:center}
    .dot{width:8px; height:8px; border-radius:50%; background:#2a3952}
    .dot.on{background:#6ba8ff}
    .x{border:0; background:transparent; color:var(--muted); font-size:18px; cursor:pointer}
    .bd{padding:16px; overflow:auto}
    .card{background:var(--panel2); border:1px solid var(--line); border-radius:14px; padding:14px 16px; margin:10px 0}
    .row{display:flex; gap:16px; flex-wrap:wrap}
    .col{flex:1 1 300px}
    .row2{display:grid; grid-template-columns:1fr 1fr; gap:18px}
    @media (max-width:860px){ .row2{grid-template-columns:1fr} }

    .pill{display:flex; flex-direction:column; gap:4px; padding:12px; border-radius:14px; border:1px solid var(--line); background:#0f1626; cursor:pointer}
    .pill.on{outline:2px solid #74ff9d44; background:#102035}
    .muted{color:var(--muted)} .note{color:var(--muted); font-size:12px}

    label.lbl{display:block; font-weight:700; margin:10px 0 6px}
    input,textarea{width:100%; background:#0e1523; border:1px solid var(--line); color:var(--text); padding:10px 12px; border-radius:10px; outline:none}
    input:focus{border-color:#365f9b; box-shadow:0 0 0 3px rgba(100,180,255,.15)}

    .btn{cursor:pointer; border:1px solid var(--line); background:#142033; color:var(--text); border-radius:10px; padding:10px 12px}
    .btn.primary{background:var(--cta); color:var(--ctaText); border-color:transparent}
    .btn.ghost{background:transparent}
    .btn.small{padding:6px 9px; border-radius:8px; font-size:12px}
    .center{display:flex; justify-content:center; gap:8px; margin:10px 0}

    .headline{display:flex; align-items:center; gap:10px; padding:14px 16px; border-radius:12px; border:1px solid var(--line); background:#0e1626; font-size:18px}
    .fav{width:28px; height:28px; border-radius:6px; background:#0c1421}

    .chips{display:flex; flex-wrap:wrap; gap:8px}
    .chip{user-select:none; padding:7px 10px; border-radius:999px; background:var(--chip); border:1px solid var(--line); cursor:pointer}
    .chip.on{background:var(--chipOn); outline:2px solid #3a5172}
    .sl{display:grid; grid-template-columns:1fr auto; align-items:center; gap:10px}
    .slider{appearance:none; height:6px; background:#2a3952; border-radius:10px}
    .slider::-webkit-slider-thumb{appearance:none; width:14px; height:14px; border-radius:50%; background:#8bbcff}
    .dim{opacity:.45; pointer-events:none; filter:grayscale(.15)}
    .link{color:var(--accent); text-decoration:underline; cursor:pointer}
    .err{color:var(--danger); margin-top:6px}
    .tip{position:fixed; display:none; z-index:100; background:#0b1524; border:1px solid var(--line); color:var(--text); padding:8px 10px; border-radius:8px; font-size:12px; max-width:260px}
  </style>
</head>
<body>
  <div class="hero">
    <div class="hero-inner">
      <h1><strong>Find real packaging buyers.</strong> Hot leads, not hot air.</h1>
      <p class="sub">Start free. Deterministic discovery now. AI enrichment when it truly helps.</p>
      <a id="open" class="cta" href="#">Get qualified leads free</a>
    </div>
  </div>

  <div id="scrim" class="scrim" role="dialog" aria-modal="true" aria-labelledby="onbTitle">
    <div class="modal">
      <div class="hd">
        <div class="tt" id="onbTitle">Get set up in 60 seconds</div>
        <div class="dots"><div class="dot on"></div><div class="dot"></div><div class="dot"></div></div>
        <button id="x" class="x">✕</button>
      </div>
      <div id="panel" class="bd"></div>
    </div>
  </div>

  <div id="tip" class="tip"></div>

  <script>
    // ------------ helpers / state
    const API_BASE = "/api";
    const $ = sel => document.querySelector(sel);
    const panel = $("#panel"), scrim = $("#scrim"), tip = $("#tip");
    const dots = () => Array.from(document.querySelectorAll(".dots .dot"));

    const S = {
      role:"supplier",
      name:"", email:"", phone:"", host:"",
      prefs:{ locality:6, ecom:7, retail:5, wholesale:6, mids:6, avoidGiants:7, focusTags:[], sectors:[], city:"" },
      classify:null
    };

    const emailDomain = e => (String(e||"").toLowerCase().match(/@([a-z0-9.-]+)/)||[])[1] || "";
    const fav = h => `https://www.google.com/s2/favicons?domain=${encodeURIComponent(h)}&sz=64`;

    const chip = (t,on=false) => {
      const el = document.createElement("span");
      el.className = "chip"+(on?" on":"");
      el.textContent = t;
      el.onclick = () => el.classList.toggle("on");
      return el;
    };
    const fillChips = (el, arr=[]) => { el.innerHTML=""; arr.forEach(t=>el.appendChild(chip(t))); };
    const selected = el => Array.from(el.querySelectorAll(".chip.on")).map(x=>x.textContent.trim());

    const showTip = (txt,x,y)=>{ tip.textContent=txt; tip.style.display="block"; const pad=10; tip.style.left=(x+pad)+"px"; tip.style.top=(y+pad)+"px"; };
    const hideTip = ()=> tip.style.display="none";

    const setStep = n => dots().forEach((d,i)=>d.classList.toggle("on", i===n));

    // ------------ step 1
    function stepRole(){
      setStep(0);
      panel.innerHTML = `
        <div class="row">
          <div class="col">
            <div id="optSup" class="pill ${S.role==='supplier'?'on':''}" tabindex="0" role="button" aria-pressed="${S.role==='supplier'}">
              <div style="font-weight:800">I sell packaging (Supplier)</div>
              <div class="muted">You’ll get buyer leads tuned to your strengths.</div>
              <div class="note" style="margin-top:6px">Examples: manufacturers, custom shops, converters, wholesalers, distributors, label & box producers.</div>
            </div>
          </div>
          <div class="col">
            <div id="optBuy" class="pill ${S.role==='buyer'?'on':''}" tabindex="0" role="button" aria-pressed="${S.role==='buyer'}">
              <div style="font-weight:800">I buy packaging (Buyer)</div>
              <div class="muted">We’re prioritizing suppliers. Buyers can browse too (limited).</div>
              <div class="note" style="margin-top:6px">Examples: brands & retailers, DTC/e-commerce, co-packers, CPG, cosmetics, beverage, food.</div>
            </div>
          </div>
        </div>
        <div class="row" style="justify-content:flex-end; margin-top:12px">
          <button id="b1" class="btn ghost">Back</button>
          <button id="n1" class="btn primary">Next</button>
        </div>
      `;
      $("#optSup").onclick=()=>{S.role='supplier'; stepRole();};
      $("#optBuy").onclick=()=>{S.role='buyer'; stepRole();};
      $("#b1").onclick=close;
      $("#n1").onclick=stepProfile;
    }

    // ------------ step 2
    function stepProfile(){
      setStep(1);
      panel.innerHTML = `
        <div class="row2 card">
          <div>
            <label class="lbl" for="name">Your name</label>
            <input id="name" autocomplete="name" placeholder="e.g., Alex Chen" value="${S.name}">
          </div>
          <div>
            <label class="lbl" for="email">Business email *</label>
            <input id="email" type="email" autocomplete="email" placeholder="name@company.com" value="${S.email}">
          </div>
          <div>
            <label class="lbl" for="phone">Phone (required for alerts) *</label>
            <input id="phone" inputmode="tel" autocomplete="tel" placeholder="+1 555 123 4567" value="${S.phone}">
            <div class="note">Country code helps us personalize geography (e.g., “+1” for U.S.). Testing mode: verification skipped.</div>
          </div>
          <div>
            <label class="lbl" for="host">Website / Domain (auto from email)</label>
            <input id="host" placeholder="company.com" value="${S.host}">
            <div class="note">Auto-filled from your email as you type. You can edit.</div>
          </div>
        </div>
        <div class="row" style="justify-content:flex-end; margin-top:12px">
          <button id="b2" class="btn ghost">Back</button>
          <button id="n2" class="btn primary">Next</button>
        </div>
      `;
      const email=$("#email"), host=$("#host");
      const sync=()=>{ const d=emailDomain(email.value); if(d && (!host.value || host.value===S.host || host.value.includes("@"))) host.value=d; };
      email.addEventListener("input", sync);
      setTimeout(sync, 150); // catch browser autofill
      $("#b2").onclick=stepRole;
      $("#n2").onclick=()=>{ S.name=$("#name").value.trim(); S.email=email.value.trim(); S.phone=$("#phone").value.trim();
        S.host=host.value.trim().replace(/^https?:\/\//,'').replace(/\/.*$/,''); stepSummary(); classify(S.host,S.email); };
    }

    // ------------ classify + headline
    async function classify(host,email){
      if(!host) return;
      setHeadline({host,loading:true});
      try{
        const res = await fetch(`${API_BASE}/classify?host=${encodeURIComponent(host)}${email?`&email=${encodeURIComponent(email)}`:''}`);
        if(!res.ok) throw new Error("http_"+res.status);
        const data = await res.json();
        if(data && data.ok){
          S.classify = data;
          setHeadline({host, oneLiner:data.oneLiner, favicon:data.favicon});
          // seed chips
          if($("#prodChips") && data.productTags) fillChips($("#prodChips"), data.productTags);
          if($("#sectChips") && data.sectors) fillChips($("#sectChips"), data.sectors);
        }else{
          setHeadline({host, error:(data && (data.error||data.detail)) || "network error while reading your site."});
        }
      }catch(e){
        setHeadline({host, error:"network error while reading your site."});
      }
    }
    function setHeadline({host, oneLiner, favicon, loading, error}){
      const ic=$("#fav"), t=$("#one"), err=$("#err");
      ic.src = favicon || fav(host);
      if(loading){ t.textContent = `${host} — loading…`; err.textContent=""; return; }
      if(error){ t.textContent = `${host} — ${error}`; err.textContent=""; return; }
      t.textContent = oneLiner || `${host} — `;
      err.textContent="";
    }

    // ------------ step 3
    function stepSummary(){
      setStep(2);
      panel.innerHTML = `
        <div class="card">
          <div class="headline">
            <img id="fav" class="fav" alt="">
            <div id="one">your-company sells packaging to brands.</div>
          </div>
          <div class="center"><a id="refresh" class="link">Refresh from website</a></div>

          <div class="center"><button id="toggle" class="btn small">Show advanced ▾</button></div>
          <div class="note" style="text-align:center; margin-bottom:10px">Optional: refine ranking and add product-specific details.</div>

          <div id="adv" style="display:none">
            <div class="row2">
              <div id="genCard" class="card">
                <div style="display:flex; align-items:center; justify-content:space-between">
                  <div style="font-weight:800">General tuning</div>
                  <label class="note"><input id="genAuto" type="checkbox"> Let AI decide</label>
                </div>
                <div class="sl"><div>📍 Prioritize nearby buyers <span class="muted" data-tip="Boosts leads near your chosen city.">ⓘ</span></div><input id="sLocal" class="slider" type="range" min="0" max="10" value="${S.prefs.locality}"></div>
                <div class="sl"><div>🛒 Prefer e-commerce sites <span class="muted" data-tip="Brands with carts or product grids.">ⓘ</span></div><input id="sEcom" class="slider" type="range" min="0" max="10" value="${S.prefs.ecom}"></div>
                <div class="sl"><div>🏷️ Prefer retail brands <span class="muted" data-tip="DTC / retail-facing brands.">ⓘ</span></div><input id="sRetail" class="slider" type="range" min="0" max="10" value="${S.prefs.retail}"></div>
                <div class="sl"><div>📦 Prefer wholesalers / distributors <span class="muted" data-tip="Companies that resell widely.">ⓘ</span></div><input id="sWholesale" class="slider" type="range" min="0" max="10" value="${S.prefs.wholesale}"></div>
                <div class="sl"><div>🏗️ Prefer mid-size companies <span class="muted" data-tip="Bias away from tiny or giant orgs.">ⓘ</span></div><input id="sMids" class="slider" type="range" min="0" max="10" value="${S.prefs.mids}"></div>
                <div class="sl"><div>🏙️ De-prioritize giant enterprises <span class="muted" data-tip="Down-weight Fortune-scale giants.">ⓘ</span></div><input id="sAvoid" class="slider" type="range" min="0" max="10" value="${S.prefs.avoidGiants}"></div>
              </div>

              <div id="prodCard" class="card">
                <div style="display:flex; align-items:center; justify-content:space-between">
                  <div style="font-weight:800">Product signals (from your site)</div>
                  <label class="note"><input id="prodAuto" type="checkbox"> Let AI decide</label>
                </div>
                <div class="note" style="margin-bottom:8px">Tap to select. We’ll use these as focus tags.</div>
                <div id="prodChips" class="chips"></div>
              </div>
            </div>

            <div class="card">
              <div style="font-weight:800; margin-bottom:6px">Buyer targeting</div>
              <div class="row2">
                <div>
                  <label class="lbl">Find buyers near…</label>
                  <input id="city" placeholder="e.g., Chicago">
                  <div id="cityChips" class="chips" style="margin-top:8px"></div>
                  <div class="note">We’ll boost leads near this city.</div>
                </div>
                <div>
                  <label class="lbl">Buyers in these sectors</label>
                  <input id="sectInput" placeholder="e.g., food, beverage, cosmetics">
                  <div id="sectChips" class="chips" style="margin-top:8px"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="row" style="justify-content:flex-end; margin-top:12px">
            <button id="back3" class="btn ghost">Back</button>
            <button id="next3" class="btn primary">Next</button>
          </div>
          <div id="err" class="err"></div>
        </div>
      `;

      // headline initial
      $("#fav").src = fav(S.host);
      $("#one").textContent = S.classify?.oneLiner || (S.host ? `${S.host} — ` : "your-company sells packaging to brands.");

      // refresh
      $("#refresh").onclick = (e)=>{ e.preventDefault(); classify(S.host, S.email); };

      // show/hide advanced
      const adv=$("#adv"), toggle=$("#toggle");
      toggle.onclick=()=>{ const open=adv.style.display!=="none"; adv.style.display=open?"none":"block"; toggle.textContent=open?"Show advanced ▾":"Hide advanced ▲"; };

      // tooltips instant (hover + tap)
      panel.querySelectorAll("[data-tip]").forEach(el=>{
        const txt = el.getAttribute("data-tip");
        el.addEventListener("mouseenter", ev=>showTip(txt, ev.clientX, ev.clientY));
        el.addEventListener("mouseleave", hideTip);
        el.addEventListener("click", ev=>{ if(tip.style.display==="block") hideTip(); else showTip(txt, ev.clientX, ev.clientY); });
      });
      document.addEventListener("scroll", hideTip, {passive:true});

      // AI decide toggles
      function setDisabled(card, chkId){
        const on = $(chkId).checked;
        card.classList.toggle("dim", on);
        card.querySelectorAll("input[type=range], .chip").forEach(el=> el.disabled = on);
      }
      $("#genAuto").addEventListener("change", ()=>setDisabled($("#genCard"), "#genAuto")); setDisabled($("#genCard"), "#genAuto");
      $("#prodAuto").addEventListener("change", ()=>setDisabled($("#prodCard"), "#prodAuto")); setDisabled($("#prodCard"), "#prodAuto");

      // suggestions
      fillChips($("#cityChips"), ["Chicago","New York","Los Angeles","Dallas","Atlanta","Miami"]);
      $("#cityChips").onclick = e => { if(e.target.classList.contains("chip")) $("#city").value = e.target.textContent.trim(); };

      // pre-fill chips from classify if present
      if(S.classify?.productTags) fillChips($("#prodChips"), S.classify.productTags);
      if(S.classify?.sectors) fillChips($("#sectChips"), S.classify.sectors);

      $("#back3").onclick = stepProfile;
      $("#next3").onclick = ()=>{
        S.prefs.focusTags = selected($("#prodChips"));
        const typed = $("#sectInput").value.split(",").map(s=>s.trim()).filter(Boolean);
        S.prefs.sectors = Array.from(new Set([...typed, ...selected($("#sectChips"))]));
        S.prefs.city = $("#city").value.trim();
        close(); // handoff to Free Panel later
      };
    }

    // ------------ modal open/close
    function open(){ scrim.classList.add("on"); document.body.style.overflow="hidden"; stepRole(); }
    function close(){ scrim.classList.remove("on"); document.body.style.overflow=""; hideTip(); }

    // ------------ wire events
    $("#open").onclick = (e)=>{ e.preventDefault(); open(); };
    $("#x").onclick = close;
    scrim.addEventListener("click", e=>{ if(e.target===scrim) close(); });
  </script>
</body>
</html>