<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Galactly — Find real packaging buyers</title>
<style>
  :root{
    --bg:#0e1217; --card:#121821; --muted:#8aa0b5; --text:#e9f1f7;
    --primary:#72d2ff; --accent:#38e17b; --chip:#1a2432; --chip-border:#243142;
    --slider:#90a4b8; --slider-track:#273244; --danger:#ff6b6b;
    --btn:#7fe3ff; --btn-text:#06202a;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  .hero{max-width:1100px;margin:64px auto;padding:24px 20px;text-align:center}
  h1{font-weight:800;font-size:40px;letter-spacing:-.02em;margin:0 0 16px}
  p.sub{color:var(--muted);margin:0 0 28px}
  .cta{background:var(--btn);color:var(--btn-text);border:0;border-radius:14px;padding:14px 22px;font-weight:700;cursor:pointer}
  /* modal */
  .overlay{position:fixed;inset:0;background:#0008;display:none;align-items:center;justify-content:center;padding:24px}
  .overlay.show{display:flex}
  .modal{width:min(920px,100%);background:var(--card);border-radius:16px;box-shadow:0 18px 60px #000a;border:1px solid #1a2736;position:relative}
  .modal-header{display:flex;align-items:center;justify-content:space-between;padding:16px 18px;border-bottom:1px solid #1a2736}
  .modal-title{font-weight:800}
  .close{background:transparent;border:0;color:var(--muted);font-size:22px;cursor:pointer}
  .body{padding:18px}
  .dots{display:flex;gap:6px}
  .dot{width:8px;height:8px;border-radius:50%;background:#223041}
  .dot.on{background:#6fc3ff}
  .gear{color:var(--muted);font-size:18px;cursor:pointer;margin-left:10px}
  .pill{background:#123042;color:#9cd6ff;border-radius:999px;padding:6px 10px;font-size:12px;margin-left:8px}
  .row{display:flex;gap:18px;flex-wrap:wrap}
  .col{flex:1 1 380px}
  .card{background:#0f1520;border:1px solid #1a2736;border-radius:12px;padding:14px}
  .mini{color:var(--muted);font-size:13px}
  .btn{background:var(--btn);color:var(--btn-text);border:0;border-radius:12px;padding:10px 16px;font-weight:700;cursor:pointer}
  .btn.secondary{background:#233043;color:#cfe7ff}
  .btn-row{display:flex;justify-content:flex-end;gap:10px;margin-top:18px}
  .select-cards{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .sel{border:2px solid transparent;border-radius:14px;padding:16px;background:#0f1622;cursor:pointer}
  .sel.active{border-color:#4df07c;box-shadow:0 0 0 4px #4df07c22}
  .sel h3{margin:0 0 6px}
  .help{color:var(--muted);font-size:12px}
  .field{display:flex;flex-direction:column;gap:6px;margin:10px 0}
  .field input{background:#0d131d;color:var(--text);border:1px solid #1a2736;border-radius:10px;padding:10px 12px}
  .company-line{display:flex;align-items:center;gap:12px;justify-content:center;background:#0f1622;border:1px solid #1a2736;border-radius:12px;padding:16px;min-height:80px}
  .center{display:flex;justify-content:center;align-items:center}
  .link{color:var(--primary);text-decoration:none}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
  .chips{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  .chip{border:1px solid var(--chip-border);background:var(--chip);border-radius:999px;padding:6px 10px;font-size:13px;cursor:pointer}
  .chip.selected{outline:2px solid var(--accent)}
  .slider-row{display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:10px;margin:8px 0}
  input[type=range]{accent-color:var(--slider);width:100%}
  .error{color:var(--danger)}
</style>
</head>
<body>
  <div class="hero">
    <h1>Find real packaging buyers</h1>
    <p class="sub">Laser-targeted leads, tuned to your strengths. Start free.</p>
    <button id="openCta" class="cta">Get qualified leads free</button>
  </div>

  <div id="overlay" class="overlay">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-header">
        <div class="modal-title">Get set up in 60 seconds</div>
        <div class="center" style="gap:10px">
          <div class="dots">
            <div class="dot" id="d1"></div>
            <div class="dot" id="d2"></div>
            <div class="dot" id="d3"></div>
          </div>
          <span id="envBadge" class="pill" style="display:none"></span>
          <a id="setApi" class="gear" title="Set API base">⚙️</a>
          <button id="closeBtn" class="close" aria-label="Close">×</button>
        </div>
      </div>
      <div class="body">
        <!-- steps container -->
        <div id="step1" style="display:none">
          <div class="select-cards">
            <div id="optSupplier" class="sel active" role="button" tabindex="0">
              <h3>I sell packaging (Supplier)</h3>
              <div class="mini">You’ll get buyer leads tuned to your strengths.<br>Examples: <b>manufacturers</b>, <b>custom shops</b>, <b>converters</b>, <b>wholesalers</b>, <b>distributors</b>, <b>label & box producers</b>.</div>
            </div>
            <div id="optBuyer" class="sel" role="button" tabindex="0">
              <h3>I buy packaging (Buyer)</h3>
              <div class="mini">We’re prioritizing suppliers. Buyers can browse too (limited).<br>Examples: <b>brands & retailers</b>, <b>DTC/e-commerce</b>, <b>co-packers</b>, <b>CPG</b>, <b>cosmetics</b>, <b>beverage</b>, <b>food</b>.</div>
            </div>
          </div>
          <div class="btn-row">
            <button class="btn" id="s1Next">Next</button>
          </div>
        </div>

        <div id="step2" style="display:none">
          <div class="row">
            <div class="col">
              <div class="field">
                <label>Your name</label>
                <input id="nameInput" placeholder="e.g., Alex Rivera" autocomplete="name">
              </div>
              <div class="field">
                <label>Phone (required for alerts)</label>
                <input id="phoneInput" inputmode="tel" placeholder="+1 415 555 0123" autocomplete="tel">
                <div class="help">Country code helps personalize geography (e.g., “+1” for U.S.).</div>
              </div>
            </div>
            <div class="col">
              <div class="field">
                <label>Business email *</label>
                <input id="emailInput" type="email" placeholder="you@yourcompany.com" autocomplete="email" required>
              </div>
              <div class="field">
                <label>Website / Domain (auto from email)</label>
                <input id="domainInput" placeholder="yourcompany.com" autocomplete="url">
                <div class="help">Auto-filled from your email as you type. You can edit.</div>
              </div>
            </div>
          </div>
          <div class="btn-row">
            <button class="btn secondary" id="s2Back">Back</button>
            <button class="btn" id="s2Next">Next</button>
          </div>
        </div>

        <div id="step3" style="display:none">
          <div class="card">
            <div class="company-line">
              <img id="favicon" src="" alt="" width="28" height="28" style="border-radius:6px;display:none">
              <div id="oneLiner">your-company — <b>fetching summary…</b></div>
            </div>
            <div class="center mini" style="margin-top:8px;">
              <a href="#" id="refreshLink" class="link">Refresh from website</a>
              <span id="fetchMsg" class="mini" style="margin-left:8px;"></span>
            </div>

            <div class="center" style="margin:14px 0;">
              <button id="advToggle" class="btn secondary"><span id="advLabel">Show</span> advanced ▾</button>
            </div>

            <div id="advanced" style="display:none">
              <div class="mini center" style="margin-bottom:8px;">Optional: refine ranking and add product-specific details.</div>
              <div class="grid">
                <div class="card">
                  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
                    <b>General tuning</b>
                    <label class="mini"><input type="checkbox" id="aiGeneral"> Let AI decide</label>
                  </div>
                  <div id="sliders"></div>
                </div>
                <div class="card">
                  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
                    <b>Product signals (from your site)</b>
                    <label class="mini"><input type="checkbox" id="aiProduct"> Let AI decide</label>
                  </div>
                  <div class="mini">Tap to select. We’ll use these as focus tags.</div>
                  <div id="productChips" class="chips"></div>
                </div>
              </div>

              <div class="card" style="margin-top:14px">
                <b>Buyer targeting</b>
                <div class="row">
                  <div class="col">
                    <div class="field">
                      <label>Find buyers near…</label>
                      <input id="cityInput" placeholder="e.g., Chicago" autocomplete="address-level2">
                      <div id="cityChips" class="chips"></div>
                      <div class="help">We’ll boost leads near this city.</div>
                    </div>
                  </div>
                  <div class="col">
                    <div class="field">
                      <label>Buyers in these sectors</label>
                      <input id="sectorInput" placeholder="e.g., food, beverage, cosmetics">
                      <div id="sectorChips" class="chips"></div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="btn-row">
                <button class="btn secondary" id="s3Back">Back</button>
                <button class="btn" id="s3Next">Next</button>
              </div>
            </div>
          </div>
        </div>

      </div><!-- /body -->
    </div>
  </div>

<script>
/* --------------------- helpers --------------------- */
const $ = s => document.querySelector(s);
const dot = n => $("#d"+n);
function setDots(n){ [1,2,3].forEach(i=>dot(i).classList.toggle("on", i===n)); }
function chip(label, selected=false, onToggle=()=>{}){
  const el=document.createElement("button");
  el.type="button"; el.className="chip"+(selected?" selected":""); el.textContent=label;
  el.onclick=()=>{ el.classList.toggle("selected"); onToggle(el.classList.contains("selected")); };
  return el;
}
function sliderRow(label, val=5, min=0, max=10){
  const row=document.createElement("div"); row.className="slider-row";
  const name=document.createElement("div"); name.textContent=label;
  const input=document.createElement("input"); input.type="range"; input.min=min; input.max=max; input.value=val;
  const out=document.createElement("div"); out.textContent=val;
  input.oninput=()=> out.textContent=input.value;
  row.append(name,input,out); return row;
}
/* --------------------- API base resolver --------------------- */
async function resolveApiBase(){
  const qs=new URLSearchParams(location.search);
  const fromQS=qs.get("api"); if(fromQS){ localStorage.setItem("apiBase", fromQS); }
  const candidates=[
    localStorage.getItem("apiBase")||"",
    (typeof window.API_BASE==="string" ? window.API_BASE : ""),
    location.origin
  ].filter(Boolean);
  for(const base of candidates){
    try{
      const r=await fetch(base.replace(/\/$/,"")+"/healthz",{mode:"cors"});
      const t=await r.text().catch(()=> ""); if(r.ok && /ok/i.test(t)){ return base.replace(/\/$/,""); }
    }catch(_){}
  }
  throw new Error("NO_API");
}
function setApiBaseInteractively(){
  const v=prompt("Enter API base URL (your Northflank service URL).\nExample: https://animated-cellar--xxxx.code.run");
  if(v && /^https?:\/\//i.test(v)){ localStorage.setItem("apiBase", v.replace(/\/$/,"")); location.reload(); }
}
/* --------------------- state --------------------- */
let API_BASE=""; let state={ role:"supplier", name:"", email:"", phone:"", website:"" };
function save(){ localStorage.setItem("onboard", JSON.stringify(state)); }
function load(){ try{ state=Object.assign(state, JSON.parse(localStorage.getItem("onboard")||"{}")); }catch(_){} }
/* --------------------- steps wiring --------------------- */
const overlay=$("#overlay");
$("#openCta").onclick=()=>{ overlay.classList.add("show"); showStep(1); };
$("#closeBtn").onclick=()=> overlay.classList.remove("show");
$("#setApi").onclick=setApiBaseInteractively;

function showStep(n){
  setDots(n);
  ["#step1","#step2","#step3"].forEach((s,i)=>{ const el=$(s); el.style.display=(i===n-1)?"block":"none"; });
  if(n===1) step1Init();
  if(n===2) step2Init();
  if(n===3) step3Init();
}

/* ----- Step 1 ----- */
function step1Init(){
  load();
  const a=$("#optSupplier"), b=$("#optBuyer");
  function sel(role){ state.role=role; a.classList.toggle("active", role==="supplier"); b.classList.toggle("active", role!=="supplier"); save(); }
  a.onclick=()=>sel("supplier"); b.onclick=()=>sel("buyer"); sel(state.role||"supplier");
  $("#s1Next").onclick=()=> showStep(2);
}

/* ----- Step 2 ----- */
function step2Init(){
  load();
  const name=$("#nameInput"), email=$("#emailInput"), phone=$("#phoneInput"), dom=$("#domainInput");
  name.value=state.name||""; email.value=state.email||""; phone.value=state.phone||""; dom.value=state.website||"";

  let domainTouched=false;
  dom.addEventListener("input", ()=> domainTouched=true);

  function derive(){
    const m = String(email.value||"").toLowerCase().match(/@([a-z0-9.-]+)/);
    const d = m?.[1] || "";
    if(!domainTouched){ dom.value = d; }
    if(!email.value && !domainTouched){ dom.value=""; }
  }
  email.addEventListener("input", derive);
  email.addEventListener("change", derive);

  // handle browser autofill (fires no input): poll briefly
  let tries=0; const t=setInterval(()=>{ tries++; if(email.value && !dom.value){ derive(); } if(tries>20){ clearInterval(t); } },100);

  $("#s2Back").onclick=()=> showStep(1);
  $("#s2Next").onclick=()=>{
    if(!email.value || !dom.value || !phone.value){
      alert("Please enter business email, phone and website."); return;
    }
    state.name=name.value.trim(); state.email=email.value.trim(); state.phone=phone.value.trim(); state.website=dom.value.trim().replace(/^https?:\/\//,"").replace(/\/.*$/,""); save();
    showStep(3);
  };
}

/* ----- Step 3 ----- */
let currentHost=""; let currentEmail="";
function faviconFor(host){
  const url=`https://t3.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&size=64&url=https://${encodeURIComponent(host)}`;
  const img=$("#favicon"); img.src=url; img.style.display="block";
}
function setOneLiner(text, host){ $("#oneLiner").innerHTML=`<b>${host||"your-company"}</b> — ${text}`; }
async function callSummary(host,email){
  const u=new URL(API_BASE+"/api/classify/summary"); u.searchParams.set("host",host); if(email) u.searchParams.set("email",email);
  const r=await fetch(u,{mode:"cors"});
  if(r.status===404){
    const u2=new URL(API_BASE+"/api/classify"); u2.searchParams.set("host",host); if(email) u2.searchParams.set("email",email);
    const r2=await fetch(u2,{mode:"cors"}); const j2=await r2.json();
    return { ok: !!j2.ok, summary:"", tags:[], sectors:[], cities:[], tuning:[], raw:j2 };
  }
  return await r.json();
}
function muteSection(chk, els){
  const set=(on)=> els.forEach(el=> el.style.opacity = on? ".45":"1");
  chk.onchange = ()=> set(chk.checked);
  set(chk.checked);
}
async function step3Init(){
  load();
  $("#advanced").style.display="none"; $("#advLabel").textContent="Show";
  $("#productChips").innerHTML=""; $("#sectorChips").innerHTML=""; $("#cityChips").innerHTML=""; $("#sliders").innerHTML="";
  $("#fetchMsg").textContent="";

  try{
    API_BASE=await resolveApiBase(); $("#envBadge").style.display="inline-block"; $("#envBadge").textContent=new URL(API_BASE).host;
  }catch(_){
    $("#fetchMsg").innerHTML = `<span class="error">Set API (click the gear).</span>`; setOneLiner("unable to connect — API base is not set.","your-company"); return;
  }

  currentHost = (state.website||"").replace(/^https?:\/\//,"").replace(/\/.*$/,"");
  currentEmail = state.email||"";
  if(!currentHost){ setOneLiner("please go back and enter your website.","your-company"); return; }

  faviconFor(currentHost); setOneLiner("fetching summary…", currentHost);

  async function run(){
    $("#fetchMsg").textContent="";
    try{
      const data=await callSummary(currentHost,currentEmail);
      if(!data || data.ok===false){ $("#fetchMsg").innerHTML=`<span class="error">Network error while reading your site.</span>`; setOneLiner("network error while reading your site.",currentHost); return; }
      const summary=data.summary || "sells packaging to brands.";
      setOneLiner(summary,currentHost);

      const prodWrap=$("#productChips");
      (data.tags||[]).slice(0,14).forEach(t=> prodWrap.append(chip(t,true)));
      const sectWrap=$("#sectorChips");
      (data.sectors||["food","beverage","cosmetics","electronics","apparel"]).slice(0,10).forEach(t=> sectWrap.append(chip(t)));
      const cityWrap=$("#cityChips");
      (data.cities||["Chicago","New York","Los Angeles","Dallas","Atlanta","Miami"]).slice(0,10).forEach(c=> cityWrap.append(chip(c)));

      const s=$("#sliders");
      ["Prioritize nearby buyers","Prefer e-commerce sites","Prefer retail brands","Prefer wholesalers / distributors","Prefer mid-size companies","De-prioritize giant enterprises"]
        .forEach((name,i)=> s.append(sliderRow(name,(data.tuning&&data.tuning[i])||[6,7,5,6,6,7][i])));

    }catch(e){ console.error(e); $("#fetchMsg").innerHTML=`<span class="error">Network error while reading your site.</span>`; setOneLiner("network error while reading your site.",currentHost); }
  }

  $("#advToggle").onclick=()=>{ const adv=$("#advanced"); adv.style.display=adv.style.display==="none"?"block":"none"; $("#advLabel").textContent=adv.style.display==="none"?"Show":"Hide"; };
  $("#refreshLink").onclick=(e)=>{ e.preventDefault(); run(); };
  $("#s3Back").onclick=()=> showStep(2);
  $("#s3Next").onclick=()=> alert("Next → free panel (hook up later).");

  // Mute behavior
  muteSection($("#aiGeneral"), [$("#sliders")]);
  muteSection($("#aiProduct"), [$("#productChips")]);

  await run();
}

/* boot */
document.addEventListener("DOMContentLoaded", async()=>{
  try{ API_BASE=await resolveApiBase(); $("#envBadge").style.display="inline-block"; $("#envBadge").textContent=new URL(API_BASE).host; }catch(_){}
});
</script>
</body>
</html>