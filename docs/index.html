<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Galactly — Live packaging buyer signals</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@800&display=swap" rel="stylesheet">
<style>
:root{
  --ink:#e9eef7; --mut:#a7b0c3; --line:#202838; --card:#0f1420; --panel:#0b101a;
  --accent:#89ffd8; --accent2:#68a7ff; --warn:#f7c46a; --ok:#7fffd4; --bad:#ff7f7f;
  --mont:Montserrat,Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial,sans-serif;
  --inter:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial,sans-serif;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0; background:radial-gradient(1200px 700px at 80% -10%,rgba(40,70,140,.25),transparent 40%),linear-gradient(180deg,#0a0e16,#06080e 60%); color:var(--ink); font-family:var(--inter)}
a{color:inherit; text-decoration:none}
header{display:flex; align-items:center; justify-content:space-between; padding:14px 18px}
.brand{display:flex; gap:10px; align-items:center; font:800 16px var(--mont)}
.brand svg{width:22px; height:22px}
.hero{display:grid; grid-template-columns: 1.2fr 1fr; gap:28px; padding:40px 18px 24px; align-items:center}
@media (max-width: 960px){ .hero{grid-template-columns:1fr; padding-top:18px} }
.h1{font:800 clamp(28px,5vw,42px) var(--mont); letter-spacing:-.02em; line-height:1.15}
.sub{margin-top:10px; font-size:14px; opacity:.9}
.cta{margin-top:16px; display:flex; gap:10px; align-items:center; flex-wrap:wrap}
.btn{background:#131c2b; border:1px solid var(--line); color:#e9eef7; border-radius:12px; padding:12px 14px; font:700 14px var(--inter); cursor:pointer}
.btn.primary{background:linear-gradient(90deg,#fff,#e6efff); color:#10131a; border-color:transparent}
.badge{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border:1px solid var(--line); border-radius:999px; font-size:12px; color:#cdd6ea; background:#0c1220}
.badge .dot{display:inline-block; width:7px; height:7px; border-radius:50%; background:#4ae3b5; box-shadow:0 0 8px rgba(74,227,181,.6)}
.kv{display:flex; align-items:center; gap:8px; margin-top:10px; opacity:.85; font-size:12px}

.right{position:relative; height:420px; border:1px solid var(--line); border-radius:16px; background:linear-gradient(180deg,#0b0f19,#0a0e17); overflow:hidden; box-shadow:0 6px 40px rgba(0,0,0,.35) inset;}
#funnel{width:100%; height:100%; display:block}

/* mini KPI strip below canvas */
.kpi{position:absolute; left:18px; right:18px; bottom:14px; display:flex; gap:8px; flex-wrap:wrap; opacity:.95}
.chip{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border:1px solid #2a3246; background:#0f1523; border-radius:999px; font-size:12px; color:#cfe0ff}
.chip strong{color:#fff}

/* modal */
.modal{position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:40}
.modal.in{display:flex}
.box{width:min(920px,95vw); background:#0b101a; border:1px solid var(--line); border-radius:16px; overflow:hidden}
.box .head{display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--line)}
.box h3{margin:0; font:800 16px var(--mont)}
.seg{display:flex; gap:6px}
.tab{padding:8px 10px; border:1px solid var(--line); border-radius:999px; font:700 12px var(--inter); cursor:pointer}
.tab.active{background:linear-gradient(90deg,#fff,#e6efff); color:#10131a; border-color:transparent}
.pane{display:grid; grid-template-columns:1.1fr 1fr; gap:16px; padding:14px}
@media (max-width: 900px){ .pane{grid-template-columns:1fr} }
.card{background:#0f1420; border:1px solid var(--line); border-radius:14px; padding:12px}
.label{font-size:12px; opacity:.9; margin-bottom:6px}
.input, select, textarea{width:100%; background:#0f1420; border:1px solid var(--line); color:#e9eef7; border-radius:10px; padding:10px 12px; font:500 13px var(--inter)}
.grid2{display:grid; grid-template-columns:1fr 1fr; gap:10px}
.actions{display:flex; gap:10px; align-items:center; padding:12px 0 0}
.err{color:var(--bad); font-size:12px; margin-top:6px; display:none}
.ok{color:#a7ffde; font-size:12px; margin-top:6px; display:none}
.small{font-size:12px; opacity:.85}
.hr{height:1px; background:linear-gradient(90deg,transparent,#243048,transparent); margin:12px 0}
</style>
</head>
<body>
<header>
  <a class="brand" href="#">
    <svg viewBox="0 0 64 64" aria-hidden="true"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#86f7d6"/><stop offset="1" stop-color="#57a4ff"/></linearGradient></defs><circle cx="32" cy="32" r="28" stroke="url(#g)" stroke-width="2" fill="none"/><circle cx="20" cy="20" r="6" fill="url(#g)"/></svg>
    <span>Galactly</span>
  </a>
  <span class="badge"><span class="dot"></span><span id="presenceTxt">0 online</span></span>
</header>

<section class="hero">
  <div>
    <div class="h1">Find US &amp; Canada <br/> <span style="color:#86f7d6">Packaging</span> Buyers in &lt;30s</div>
    <div class="sub">Real signals from public data. Free viewer; paid automations, priority, CRM &amp; reporting. We show visible reasoning and packaging math (ad → orders → units → SKUs → queue).</div>
    <div class="cta">
      <button class="btn primary" id="start">Start free</button>
      <a class="btn" href="./free-panel.html">Open the Live Feed</a>
      <span class="small">No credit card • Free plan: 2 finds/day, 2 reveals/day</span>
    </div>
    <div class="kv"><strong>Promise:</strong> time-variant intelligence (if–then windows) + packaging math.</div>
  </div>

  <!-- RIGHT: animated funnel canvas -->
  <div class="right">
    <canvas id="funnel"></canvas>
    <div class="kpi" aria-hidden="true">
      <div class="chip">Leads / 30s <strong id="k_leads">0</strong></div>
      <div class="chip">First connection <strong id="k_first">6 sec</strong></div>
      <div class="chip">Ready now <strong id="k_ready">54%</strong></div>
      <div class="chip">Quoted <strong id="k_quoted">67%</strong></div>
      <div class="chip">Rep closed <strong id="k_rep">21%</strong></div>
      <div class="chip">Saved / mo <strong id="k_saved">$20,678</strong></div>
    </div>
  </div>
</section>

<!-- Onboarding modal -->
<div class="modal" id="onb">
  <div class="box">
    <div class="head">
      <h3>Onboarding</h3>
      <div class="seg">
        <button class="tab active" id="tabA">Path A — Enter your website</button>
        <button class="tab" id="tabB">Path B — Customize from scratch</button>
      </div>
    </div>
    <div class="pane">
      <!-- Left: Path forms -->
      <div>
        <!-- PATH A -->
        <div class="card" id="paneA">
          <div class="label">Preferred — we’ll auto-derive ICPs, buyers, and regions.</div>
          <div class="grid2">
            <div>
              <div class="label">Business email *</div>
              <input id="a_email" class="input" placeholder="you@yourcompany.com"/>
            </div>
            <div>
              <div class="label">Your role *</div>
              <select id="a_role" class="input">
                <option value="supplier">Supplier</option>
                <option value="distributor">Distributor/Wholesaler</option>
                <option value="buyer">Packaging Buyer</option>
              </select>
            </div>
          </div>
          <div class="label" style="margin-top:8px">Company website *</div>
          <input id="a_site" class="input" placeholder="yourcompany.com"/>
          <div class="grid2" style="margin-top:8px">
            <div>
              <div class="label">Region</div>
              <input id="a_region" class="input" placeholder="e.g., US, EU"/>
            </div>
            <div>
              <label style="display:flex; align-items:center; gap:8px; margin-top:22px">
                <input type="checkbox" id="a_list"/> <span>List my company for inbound opportunities</span>
              </label>
            </div>
          </div>
          <div class="hr"></div>
          <div class="small">We only serve <strong>packaging</strong> companies and buyers with real physical products. Business email domain must match your company site.</div>
          <div class="err" id="a_err"></div>
          <div class="ok" id="a_ok"></div>
          <div class="actions">
            <button class="btn" id="a_cancel">Cancel</button>
            <button class="btn primary" id="a_continue">Continue</button>
          </div>
        </div>

        <!-- PATH B -->
        <div class="card" id="paneB" style="display:none">
          <div class="label">Manual — precise filters if you prefer to steer.</div>
          <div class="grid2">
            <div>
              <div class="label">Business email *</div>
              <input id="b_email" class="input" placeholder="you@yourcompany.com"/>
            </div>
            <div>
              <div class="label">Your role *</div>
              <select id="b_role" class="input">
                <option value="supplier">Supplier</option>
                <option value="distributor">Distributor/Wholesaler</option>
                <option value="buyer">Packaging Buyer</option>
              </select>
            </div>
          </div>
          <div class="label" style="margin-top:8px">Company website *</div>
          <input id="b_site" class="input" placeholder="yourcompany.com"/>
          <div class="grid2" style="margin-top:8px">
            <div>
              <div class="label">Industries</div>
              <input id="b_industries" class="input" placeholder="beverage, confectionery"/>
            </div>
            <div>
              <div class="label">Regions</div>
              <input id="b_regions" class="input" placeholder="US, CA, EU"/>
            </div>
          </div>
          <div class="label" style="margin-top:8px">Seed buyers (domains)</div>
          <input id="b_buyers" class="input" placeholder="brand1.com, brand2.com"/>
          <div class="label" style="margin-top:8px">Describe your ideal customers</div>
          <textarea id="b_desc" class="input" rows="4" placeholder="categories, packaging materials, order sizes, retailer channels, exclusions"></textarea>
          <label style="display:flex; align-items:center; gap:8px; margin-top:10px">
            <input type="checkbox" id="b_list"/> <span>List my company for inbound opportunities</span>
          </label>
          <div class="hr"></div>
          <div class="small">We only serve <strong>packaging</strong>. Business email domain must match your company site.</div>
          <div class="err" id="b_err"></div>
          <div class="ok" id="b_ok"></div>
          <div class="actions">
            <button class="btn" id="b_cancel">Cancel</button>
            <button class="btn primary" id="b_continue">Continue</button>
          </div>
        </div>
      </div>

      <!-- Right: micro-guide -->
      <div>
        <div class="card">
          <div class="label"><strong>Tips to get great signals</strong></div>
          <ul class="small" style="margin:0 0 8px 16px; padding:0">
            <li>Use your **company domain** so we can calibrate fit and block scrapers.</li>
            <li>Focus on **physical packaging** needs (corrugate, film, shrink, label, tray, case-of-N).</li>
            <li>Seed 3–6 buyers you admire to nudge our platform rotation.</li>
          </ul>
          <div class="hr"></div>
          <div class="small">Privacy: Free plan hides raw sources on cards; Pro shows full checks. We log **per-user** proof confirmations but do not bump global heat on Free.</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* ===== API base (shared) ===== */
(function ensureApiBase(){
  if (window.API && window.API.base) return;
  const DEFAULT=(window.API_DEFAULT||'').replace(/\/$/,'') || location.origin;
  const qs=new URLSearchParams(location.search);
  function normalize(v){ if(!v) return DEFAULT; let s=String(v).trim().replace(/\/$/,''); if(!/^https?:\/\//i.test(s)) s='https://'+s; return s; }
  const saved=localStorage.getItem('apiBase'); const base=normalize(qs.get('api')||saved||DEFAULT);
  window.API_BASE=base;
  const _fetch=window.fetch.bind(window);
  const uidKey='galactly_uid'; let uid=localStorage.getItem(uidKey)||('u_'+Math.random().toString(36).slice(2)); localStorage.setItem(uidKey, uid);
  window.fetch=function(input,init){
    let url=(typeof input==='string')?input:input.url; const headers=new Headers((init&&init.headers)||(typeof input!=='string'&&input.headers)||undefined);
    try{ headers.set('x-galactly-user', uid);}catch{}
    if(url && (url.startsWith('/api/')||url.startsWith('api/'))){ url = base + (url.startsWith('/')? '': '/') + url; }
    return _fetch(typeof input==='string'?url:new Request(url,{...(init||{}),headers}));
  };
  window.API={ get base(){return base;}, uid, url:(p)=> (base + (p.startsWith('/')?p:'/'+p)) };
})();

/* ===== presence badge ===== */
async function loadPresence(){
  try{ const r=await fetch('/presence/online'); const j=await r.json(); document.getElementById('presenceTxt').textContent = (j.total||0)+' online'; }
  catch{ /* ignore */ }
}
setInterval(loadPresence, 12000); loadPresence();

/* ===== Hero canvas animation: particles → core → beams ===== */
(function initFunnel(){
  const c = document.getElementById('funnel');
  if(!c.getContext) return;
  const ctx = c.getContext('2d');
  let w=0, h=0, dpr=1, cx=0, cy=0, R=0;
  function resize(){
    dpr = Math.max(1, Math.min(2, window.devicePixelRatio||1));
    w = c.clientWidth; h = c.clientHeight;
    c.width = Math.floor(w*dpr); c.height = Math.floor(h*dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
    cx=w*0.62; cy=h*0.54; R=Math.min(w,h)*0.085; // core radius
    computeEndpoints();
  }
  window.addEventListener('resize', resize); resize();

  // Beam endpoints (Email, SMS, Call, LinkedIn, Quote, ERP) to the right
  const endpoints = [
    { label:'Email',    a:-0.18, len: Math.min(220, w*0.26) },
    { label:'SMS',      a:-0.06, len: Math.min(240, w*0.285) },
    { label:'Call',     a: 0.06, len: Math.min(260, w*0.31) },
    { label:'LinkedIn', a: 0.18, len: Math.min(280, w*0.335) },
    { label:'Quote',    a: 0.30, len: Math.min(300, w*0.36) },
    { label:'ERP',      a: 0.42, len: Math.min(320, w*0.385) },
  ];
  function computeEndpoints(){
    const base = Math.min(w,h);
    endpoints.forEach((e,i)=>{
      const len = Math.min(220 + i*18, base*0.44);
      e.x = cx + Math.cos(e.a)*len;
      e.y = cy + Math.sin(e.a)*len;
      e.len = len;
    });
  }

  // Particles: inbound (from periphery) and outbound (along beams)
  const inbound=[], outbound=[];
  const MAX_IN=120, MAX_OUT=65;

  function spawnInbound(){
    // spawn around a ring to the left
    const ringR = Math.max(w,h)*0.58;
    const a = Math.PI + (Math.random()*Math.PI*0.9 - Math.PI*0.45); // spawn left arc
    const x = cx + Math.cos(a)*ringR;
    const y = cy + Math.sin(a)*ringR;
    const speed = 0.6 + Math.random()*0.7;
    const vx = Math.cos(-a)*speed*0.15; // initial nudge towards center-ish
    const vy = Math.sin(-a)*speed*0.15;
    inbound.push({x,y,vx,vy,life: 300+Math.random()*240});
  }

  function spawnOutbound(){
    const e = endpoints[Math.floor(Math.random()*endpoints.length)];
    outbound.push({ t:0, spd: 0.008 + Math.random()*0.006, e, jitter:(Math.random()*0.7-0.35) });
  }

  // KPI counters
  const k = {
    leads: 0, first: 6, ready: 54, quoted: 67, rep: 21, saved: 20678,
    t:0
  };

  function drawBackground(){
    // vignette
    const g = ctx.createRadialGradient(cx,cy, R*0.5, cx,cy, Math.max(w,h)*0.7);
    g.addColorStop(0, 'rgba(255,255,255,0.05)');
    g.addColorStop(1, 'rgba(0,0,0,0)');
    ctx.fillStyle=g; ctx.beginPath(); ctx.rect(0,0,w,h); ctx.fill();

    // orbits
    ctx.strokeStyle='rgba(140,170,220,0.12)'; ctx.lineWidth=1;
    for(let i=1;i<=3;i++){
      ctx.beginPath();
      ctx.arc(cx,cy,R*(2+i*1.1),0,Math.PI*2);
      ctx.stroke();
    }
  }
  function drawCore(){
    // glow
    const g=ctx.createRadialGradient(cx,cy,0,cx,cy,R*2.2);
    g.addColorStop(0,'rgba(255,255,255,0.85)');
    g.addColorStop(0.2,'rgba(200,230,255,0.55)');
    g.addColorStop(1,'rgba(120,160,255,0.02)');
    ctx.fillStyle=g; ctx.beginPath(); ctx.arc(cx,cy,R,0,Math.PI*2); ctx.fill();
    // core ring
    ctx.strokeStyle='rgba(200,230,255,0.4)'; ctx.lineWidth=1.4; ctx.beginPath(); ctx.arc(cx,cy,R*1.15,0,Math.PI*2); ctx.stroke();
  }
  function drawBeams(){
    endpoints.forEach((e,i)=>{
      const grad = ctx.createLinearGradient(cx,cy, e.x,e.y);
      grad.addColorStop(0, 'rgba(255,255,255,0.9)');
      grad.addColorStop(1, 'rgba(120,180,255,0.35)');
      ctx.strokeStyle=grad; ctx.lineWidth=2;
      ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(e.x,e.y); ctx.stroke();

      // endpoint nodes
      ctx.fillStyle='rgba(160,200,255,0.35)';
      ctx.beginPath(); ctx.arc(e.x,e.y, 12, 0, Math.PI*2); ctx.fill();
      ctx.fillStyle='rgba(255,255,255,0.8)';
      ctx.beginPath(); ctx.arc(e.x,e.y, 3.2, 0, Math.PI*2); ctx.fill();

      // labels
      ctx.font='12px Inter,system-ui'; ctx.textBaseline='middle';
      ctx.fillStyle='rgba(220,235,255,0.95)';
      const off = 16;
      ctx.fillText(e.label, e.x+off, e.y);
    });
  }

  function tickInbound(){
    for(let i=inbound.length-1;i>=0;i--){
      const p = inbound[i];
      // gravity-like pull to core + slight curl
      const dx = cx - p.x, dy = cy - p.y;
      const dist = Math.sqrt(dx*dx + dy*dy) || 1;
      const ax = (dx/dist) * 0.08;
      const ay = (dy/dist) * 0.08;
      // swirl
      const swirl = 0.035;
      p.vx += ax + (-dy/dist)*swirl;
      p.vy += ay + ( dx/dist)*swirl;
      // friction
      p.vx *= 0.985; p.vy *= 0.985;
      p.x += p.vx; p.y += p.vy; p.life--;

      // draw
      const alpha = Math.min(0.8, 0.15 + 140/dist);
      ctx.strokeStyle = `rgba(150,200,255,${Math.max(0.05, Math.min(0.35, alpha))})`;
      ctx.lineWidth = 1;
      ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(p.x - p.vx*3, p.y - p.vy*3); ctx.stroke();
      ctx.fillStyle = 'rgba(255,255,255,0.9)'; ctx.beginPath(); ctx.arc(p.x,p.y, 1.2, 0, Math.PI*2); ctx.fill();

      if (dist < R*0.9 || p.life<=0){
        inbound.splice(i,1);
        spawnOutbound();
      }
    }
    // keep population
    while(inbound.length < MAX_IN) spawnInbound();
  }

  function tickOutbound(){
    for(let i=outbound.length-1;i>=0;i--){
      const o = outbound[i];
      o.t += o.spd;
      if (o.t>=1){
        outbound.splice(i,1);
        continue;
      }
      // path along beam from core to endpoint with mild jitter
      const bx = cx + (o.e.x - cx)*o.t + Math.sin(o.t*10)*o.jitter*4;
      const by = cy + (o.e.y - cy)*o.t + Math.cos(o.t*10)*o.jitter*4;
      const sz = 1.2 + Math.sin(o.t*Math.PI)*1.0;
      ctx.fillStyle='rgba(255,255,255,0.95)';
      ctx.beginPath(); ctx.arc(bx,by, sz, 0, Math.PI*2); ctx.fill();
    }
    while(outbound.length < MAX_OUT) spawnOutbound();
  }

  function animate(){
    ctx.clearRect(0,0,w,h);
    drawBackground();
    drawBeams();
    tickInbound();
    drawCore();
    tickOutbound();
    requestAnimationFrame(animate);
  }
  animate();

  // KPI gentle motion
  setInterval(()=>{
    k.t++;
    if (k.leads < 207) k.leads += 1 + Math.floor(Math.random()*3);
    const el = (id,v)=> document.getElementById(id).textContent = v;
    el('k_leads', k.leads);
    el('k_ready', (54 + Math.floor(Math.sin(k.t/7)*5)) + '%');
    el('k_quoted', (67 + Math.floor(Math.cos(k.t/11)*4)) + '%');
    el('k_rep', (21 + Math.floor(Math.sin(k.t/5)*3)) + '%');
    const saved = 20678 + Math.floor(Math.sin(k.t/3)*800);
    el('k_saved', '$' + saved.toLocaleString());
  }, 900);
})();

/* ===== modal logic ===== */
const modal = document.getElementById('onb');
document.getElementById('start').onclick = ()=> modal.classList.add('in');
document.getElementById('a_cancel').onclick = ()=> modal.classList.remove('in');
document.getElementById('b_cancel').onclick = ()=> modal.classList.remove('in');

const tabA=document.getElementById('tabA'), tabB=document.getElementById('tabB');
const paneA=document.getElementById('paneA'), paneB=document.getElementById('paneB');
tabA.onclick=()=>{ tabA.classList.add('active'); tabB.classList.remove('active'); paneA.style.display='block'; paneB.style.display='none'; };
tabB.onclick=()=>{ tabB.classList.add('active'); tabA.classList.remove('active'); paneB.style.display='block'; paneA.style.display='none'; };

/* ===== gating helpers ===== */
function bareHost(url){ let s=String(url||'').trim(); s=s.replace(/^https?:\/\//i,'').replace(/\/.*$/,'').replace(/^www\./i,''); return s.toLowerCase(); }
function emailDomain(email){ const m=String(email||'').trim().toLowerCase().match(/^[^@]+@([^@]+)$/); return m? m[1].replace(/^www\./,'') : ''; }
function domainsMatch(emailDom, siteDom){ if(!emailDom || !siteDom) return false; if(emailDom===siteDom) return true; return emailDom.endsWith('.'+siteDom); }
function isPackagingRole(role){ return role==='supplier' || role==='distributor' || role==='buyer'; }

/* ===== API helpers ===== */
async function post(path,body){ const r=await fetch((window.API_BASE||'')+path,{ method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify(body||{}) }); return r.json(); }

/* ===== Path A continue ===== */
document.getElementById('a_continue').onclick = async ()=>{
  const email = (document.getElementById('a_email').value||'').trim();
  const role  = (document.getElementById('a_role').value||'supplier').trim();
  const site  = (document.getElementById('a_site').value||'').trim();
  const region= (document.getElementById('a_region').value||'').trim();
  const list  = !!document.getElementById('a_list').checked;
  const errEl = document.getElementById('a_err'); const okEl=document.getElementById('a_ok');
  errEl.style.display='none'; okEl.style.display='none';

  const eDom=emailDomain(email), sDom=bareHost(site);
  if(!email || !sDom){ errEl.textContent='Please provide business email and company website.'; errEl.style.display='block'; return; }
  if(!domainsMatch(eDom, sDom)){ errEl.textContent=`Email domain (${eDom}) must match company site (${sDom}).`; errEl.style.display='block'; return; }
  if(!isPackagingRole(role)){ errEl.textContent='We only serve packaging suppliers, distributors, and buyers with real products.'; errEl.style.display='block'; return; }

  // save prefill for Free Panel
  localStorage.setItem('onb_vendor', sDom);
  localStorage.setItem('onb_role', role);
  localStorage.setItem('onb_regions', region);

  try{
    await post('/api/v1/gate', { region, email, alerts: true });
    await post('/api/v1/vault', { role, traits: { vendorDomain: sDom, industries: [], regions: region? region.split(',').map(s=>s.trim()): [], buyers: [] } });
    okEl.textContent='Validated. Redirecting…'; okEl.style.display='block';
  }catch{}

  location.href = './free-panel.html';
};

/* ===== Path B continue ===== */
document.getElementById('b_continue').onclick = async ()=>{
  const email = (document.getElementById('b_email').value||'').trim();
  const role  = (document.getElementById('b_role').value||'supplier').trim();
  const site  = (document.getElementById('b_site').value||'').trim();
  const inds  = (document.getElementById('b_industries').value||'').trim();
  const regs  = (document.getElementById('b_regions').value||'').trim();
  const buyers= (document.getElementById('b_buyers').value||'').trim();
  const desc  = (document.getElementById('b_desc').value||'').trim();
  const list  = !!document.getElementById('b_list').checked;
  const errEl = document.getElementById('b_err'); const okEl=document.getElementById('b_ok');
  errEl.style.display='none'; okEl.style.display='none';

  const eDom=emailDomain(email), sDom=bareHost(site);
  if(!email || !sDom){ errEl.textContent='Please provide business email and company website.'; errEl.style.display='block'; return; }
  if(!domainsMatch(eDom, sDom)){ errEl.textContent=`Email domain (${eDom}) must match company site (${sDom}).`; errEl.style.display='block'; return; }
  if(!isPackagingRole(role)){ errEl.textContent='We only serve packaging suppliers, distributors, and buyers with real products.'; errEl.style.display='block'; return; }

  localStorage.setItem('onb_vendor', sDom);
  localStorage.setItem('onb_role', role);
  localStorage.setItem('onb_industries', inds);
  localStorage.setItem('onb_regions', regs);
  localStorage.setItem('onb_buyers', buyers);
  localStorage.setItem('onb_desc', desc);
  localStorage.setItem('onb_list', String(list));

  try{
    await post('/api/v1/gate', { region: regs, email, alerts: true });
    await post('/api/v1/vault', { role, traits:{
      vendorDomain: sDom,
      industries: inds? inds.split(',').map(s=>s.trim()): [],
      regions: regs? regs.split(',').map(s=>s.trim()): [],
      buyers: buyers? buyers.split(',').map(s=>s.trim()): [],
      notes: desc || null
    }, listMe: list });
    okEl.textContent='Validated. Redirecting…'; okEl.style.display='block';
  }catch{}

  location.href='./free-panel.html';
};

/* ===== presence heartbeat for header ===== */
setInterval(()=>{ fetch('/presence/beat',{ method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({ role: 'supplier' }) }).catch(()=>{}) }, 15000);

/* ===== keyboard: Escape ===== */
document.addEventListener('keydown',(e)=>{ if(e.key==='Escape'){ document.getElementById('onb').classList.remove('in'); }});
</script>
</body>
</html>
