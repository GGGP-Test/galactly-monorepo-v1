<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Galactly â€” Live Feed</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@800&display=swap" rel="stylesheet">
<style>
:root{
  --ink:#eaf0ff; --mut:#a6b2c9; --line:#1e2737; --card:#0f1420; --panel:#0b101a; --pill:#10182a;
  --accent:#86f7d6; --accent2:#6fb3ff; --ok:#7fffd4; --bad:#ff8a8a;
  --mont:Montserrat,Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif;
  --inter:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;color:var(--ink);background:linear-gradient(180deg,#0a0e16,#06080e 60%);font-family:var(--inter)}
header{height:54px;display:flex;align-items:center;justify-content:space-between;padding:0 16px;border-bottom:1px solid var(--line);background:linear-gradient(180deg,#0b111b,#0a0e15)}
.brand{display:flex;gap:10px;align-items:center;font:800 16px var(--mont)}
.brand svg{width:20px;height:20px}
.grid{display:grid;grid-template-columns:1.1fr 1fr;gap:16px;max-width:1280px;margin:14px auto;padding:0 16px}
@media (max-width:1100px){ .grid{grid-template-columns:1fr} }
.left,.right{background:#0b101a;border:1px solid var(--line);border-radius:14px;overflow:hidden}
.left .head,.right .head{padding:10px 12px;border-bottom:1px solid var(--line);display:flex;align-items:center;justify-content:space-between}
.hint{font-size:12px;color:#9fb2d6;opacity:.9}
.scroller{height:calc(100vh - 140px);overflow:auto}
.card{background:#0f1420;border:1px solid var(--line);border-radius:12px;margin:12px;padding:12px}
.tags{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
.tag{padding:4px 8px;border:1px solid #2a3552;border-radius:999px;background:#0f1626;color:#cfe0ff;font-size:12px}
.lead-title{font-weight:600}
.actions{display:flex;gap:8px;margin-top:8px}
.btn{padding:8px 10px;border:1px solid #26314a;border-radius:10px;background:#111a2b;color:#eaf0ff;cursor:pointer;font-weight:600}
.btn.own{background:linear-gradient(90deg,#fff,#eaf1ff);color:#0b111b;border-color:transparent}
.lock{opacity:.7}
.mini{font-size:12px;color:#9fb2d6}
.separator{height:1px;background:linear-gradient(90deg,transparent,#253049,transparent);margin:8px 0}

/* Preview (report style) */
.section{border-top:1px dashed #223048}
.section:first-child{border-top:0}
.section .title{display:flex;align-items:center;justify-content:space-between;padding:10px 12px}
.title h3{margin:0;font:700 14px var(--inter);letter-spacing:.02em;color:#dfe9ff}
.rows{padding:0 12px 12px 12px}
.row{display:grid;grid-template-columns:58px 1fr;gap:10px;align-items:flex-start;padding:10px 0;border-top:1px solid rgba(40,60,90,.35)}
.row:first-child{border-top:0}
.lane{font:700 12px var(--inter); padding:4px 8px; border:1px solid #2a3552; border-radius:999px; background:#0f1626; color:#cfe0ff; text-align:center}
.chain{display:flex;flex-wrap:wrap;gap:6px;align-items:center}
.step{padding:4px 8px;border:1px solid #2a3552;border-radius:8px;background:#0f1626;color:#cfe0ff;font-size:12px;white-space:nowrap}
.arrow{opacity:.6}
.counts{margin-left:auto;font-size:12px;color:#a9bbda}
.locked{opacity:.7;filter:saturate(.75)}
.upsell{margin:12px;padding:12px;border:1px dashed #38509a;border-radius:12px;background:rgba(20,28,46,.6)}
.upsell strong{color:#fff}
.upsell .btn{margin-top:8px}

/* Press-and-hold */
.hold{position:relative}
.hold .bar{position:absolute;left:0;bottom:-6px;height:3px;background:linear-gradient(90deg,#86f7d6,#6fb3ff);width:0;border-radius:6px}
</style>
</head>
<body>
<header>
  <div class="brand">
    <svg viewBox="0 0 64 64" aria-hidden="true"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#86f7d6"/><stop offset="1" stop-color="#57a4ff"/></linearGradient></defs><circle cx="32" cy="32" r="28" stroke="url(#g)" stroke-width="2" fill="none"/><circle cx="20" cy="20" r="6" fill="url(#g)"/></svg>
    <span>Galactly</span>
  </div>
  <div class="hint">Free: <span id="quotaFinds">2</span> finds â€¢ <span id="quotaReveals">2</span> reveals &nbsp;â€¢&nbsp; <span id="presence">0 online</span></div>
</header>

<div class="grid">
  <!-- LEFT: Live results -->
  <div class="left">
    <div class="head">
      <div style="font:700 14px var(--inter)">Live results</div>
      <div class="hint" id="liveStatus">probing demand â†’ scanning procurement â†’ reading reviewsâ€¦</div>
    </div>
    <div class="scroller" id="liveList"></div>
  </div>

  <!-- RIGHT: Customize + Preview -->
  <div class="right">
    <div class="head">
      <div style="font:700 14px var(--inter)">Customize your AI</div>
      <div class="hint"><span id="searchesLeft">2</span> searches left â€¢ <span id="revealsLeft">2</span> reveals left</div>
    </div>
    <div style="padding:10px 12px;">
      <div class="mini">Loaded from onboarding. Tweak then <button class="btn" id="findNow">Find now</button></div>
    </div>
    <div class="separator"></div>
    <div class="head">
      <div style="font:700 14px var(--inter)">Signals Preview (report)</div>
      <div class="hint"><span id="freeCount">Free 0/0</span> â€¢ <span id="proCount">Pro 0/0</span></div>
    </div>
    <div class="scroller" id="report"></div>
  </div>
</div>

<script>
const API_BASE = (window.API_BASE || '').replace(/\/$/,'') || '';
const uidKey='galactly_uid'; let UID = localStorage.getItem(uidKey)||('u_'+Math.random().toString(36).slice(2)); localStorage.setItem(uidKey,UID);

// Mock presence (avoid 404s while backend grows)
document.getElementById('presence').textContent = (10+Math.floor(Math.random()*30))+' online';

// quotas
const quota = { finds:2, reveals:2 };
document.getElementById('quotaFinds').textContent = quota.finds;
document.getElementById('quotaReveals').textContent = quota.reveals;
document.getElementById('searchesLeft').textContent = quota.finds;
document.getElementById('revealsLeft').textContent = quota.reveals;

// Left list (demo drip)
const liveList = document.getElementById('liveList');
const demoLeads = [
  { title:'â€¢lâ€¢â€¢â€¢â€¢â€¢â€¢,â€¢â€¢â€¢ â€” â€¢â€¢ â€¢â€¢â€¢â€¢paâ€¢â€¢â€¢â€¢â€¢ sâ€¢â€¢â€¢â€¢', tags:['demand','Confidence 80% (strong)','Shift adds Fri â†’ quote Mon morning'] },
  { title:'gâ€¢â€¢â€¢â€¢â€¢,câ€¢ â€” â€¢â€¢ â€¢â€¢â€¢â€¢sâ€¢â€¢ncâ€¢ â€¢â€¢â€¢â€¢â€¢', tags:['demand','Confidence 70% (solid)','Launch week + heavy UGC â†’ contact 48â€“72h post-promo'] },
  { title:'â€¢â€¢â€¢â€¢â€¢â€¢â€¢ â€¢â€¢â€” â€¢â€¢â€¢â€¢â€¢â€¢ â€” â€¢â€¢ â€¢â€¢â€¢â€¢', tags:['procurement','Confidence 65% (fair)','Portal open + intake form change'] },
];
let drip = 0;
function addLead() {
  if (drip >= demoLeads.length) return;
  const L = demoLeads[drip++];
  const el = document.createElement('div'); el.className='card';
  const tags = document.createElement('div'); tags.className='tags';
  L.tags.forEach(t=>{ const s=document.createElement('span'); s.className='tag'; s.textContent=t; tags.appendChild(s); });
  const title = document.createElement('div'); title.className='lead-title hold'; title.textContent=L.title;
  const bar=document.createElement('div'); bar.className='bar'; title.appendChild(bar);
  const actions=document.createElement('div'); actions.className='actions';
  const why=document.createElement('button'); why.className='btn'; why.textContent='Why this?';
  const own=document.createElement('button'); own.className='btn own'; own.textContent='Own';
  actions.appendChild(why); actions.appendChild(own);
  el.appendChild(tags); el.appendChild(title); el.appendChild(actions);
  liveList.prepend(el);

  // press & hold
  let tId=null, start=0;
  const DUR=1400;
  title.addEventListener('pointerdown', ()=>{
    start=performance.now(); bar.style.width='0%'; tId=requestAnimationFrame(function tick(now){
      const pct=Math.min(1,(now-start)/DUR); bar.style.width=(pct*100)+'%';
      if(pct<1){ tId=requestAnimationFrame(tick); } else { title.textContent='Acme Pantry Co. â€” WA â€¢ corrugate â€¢ trays'; }
    });
  });
  title.addEventListener('pointerup', ()=>{ cancelAnimationFrame(tId); bar.style.width='0%'; });
}
setInterval(addLead, 2500); addLead();

// Signals Preview (SSE)
const report = document.getElementById('report');
const bySection = new Map();
let freeSeen=0, proSeen=0, total=0, haltShown=false;

function ensureSection(cat){
  if(bySection.has(cat)) return bySection.get(cat);
  const wrapper=document.createElement('div'); wrapper.className='section';
  const head=document.createElement('div'); head.className='title';
  const h3=document.createElement('h3'); h3.textContent=cat; const right=document.createElement('div'); right.className='hint';
  head.appendChild(h3); head.appendChild(right);
  const rows=document.createElement('div'); rows.className='rows';
  wrapper.appendChild(head); wrapper.appendChild(rows);
  report.appendChild(wrapper);
  const obj={ wrapper, head, right, rows, counts:{free:0,pro:0,total:0} };
  bySection.set(cat,obj);
  return obj;
}

function addRow(cat, lane, chain, counts, locked){
  const sec = ensureSection(cat);
  sec.counts.total = counts.total;
  if(lane==='free'){ sec.counts.free = counts.done; } else { sec.counts.pro = counts.done; }
  sec.right.textContent = `Free ${sec.counts.free}/${sec.counts.total} â€¢ Pro ${sec.counts.pro}/${sec.counts.total}${locked?' ðŸ”’':''}`;

  const row=document.createElement('div'); row.className='row'+(locked?' locked':'');
  const colA=document.createElement('div'); colA.className='lane'; colA.textContent=lane==='free'?'Free':'Pro';
  const colB=document.createElement('div'); colB.className='chain';
  chain.forEach((t,i)=>{
    const step=document.createElement('span'); step.className='step'; step.textContent=t; colB.appendChild(step);
    if(i!==chain.length-1){ const arrow=document.createElement('span'); arrow.className='arrow'; arrow.textContent='â†’'; colB.appendChild(arrow); }
  });
  const cnt=document.createElement('span'); cnt.className='counts'; cnt.textContent=`${counts.done}/${counts.total}`;
  colB.appendChild(cnt);
  row.appendChild(colA); row.appendChild(colB);
  sec.rows.appendChild(row);
}

function showUpsell(payload){
  if(haltShown) return; haltShown=true;
  const box=document.createElement('div'); box.className='upsell';
  box.innerHTML=`<div><strong>Free scan paused.</strong> We processed ${payload.freeDone}/${payload.total} items. Pro continues with full checks, auto-verification, JSON export, and Queue Window forecasting.</div>`;
  const btn=document.createElement('button'); btn.className='btn'; btn.textContent='Unlock full scan ($39/mo)';
  btn.onclick=()=>{ window.location.href = payload.checkout || '#'; };
  box.appendChild(btn);
  report.prepend(box);
}

function connectSSE(){
  const es = new EventSource((API_BASE||'') + '/api/v1/progress.sse', { withCredentials:false });
  es.addEventListener('open', ()=>{/* no-op */});
  es.addEventListener('tick', (ev)=>{
    const j=JSON.parse(ev.data);
    total=j.total||total;
    if(j.lane==='free'){ freeSeen=j.done; } else if(j.lane==='pro'){ proSeen=j.done; }
    addRow(j.category, j.lane, j.chain, {done:j.done,total:j.total}, j.locked===true);
    document.getElementById('freeCount').textContent = `Free ${freeSeen}/${total}`;
    document.getElementById('proCount').textContent = `Pro ${proSeen}/${total}${j.locked?' ðŸ”’':''}`;
  });
  es.addEventListener('halt', (ev)=>{ const j=JSON.parse(ev.data); showUpsell(j); });
  es.addEventListener('done', ()=>{ es.close(); });
}
connectSSE();

// Find now triggers a fresh stream (simple reload for demo)
document.getElementById('findNow').onclick=()=>{ window.location.reload(); };
</script>
</body>
</html>
